(function(){"use strict";function f(r,t){return{x:r,y:t}}function R(r){return`rgba(${r.red}, ${r.green}, ${r.blue}, ${r.alpha})`}function s(r,t,e,i=1){return{red:r,green:t,blue:e,alpha:i}}function w(r,t,e,i){return{x1:r,y1:t,x2:e,y2:i}}function X(r,t,e,i){return{x1:r,y1:t,x2:r+e,y2:t+i}}function G(r,t,e,i){return{x1:r-e,y1:t-(i??e),x2:r+e,y2:t+(i??e)}}function F(r){return[-Math.abs(r.x1-r.x2)/2,-Math.abs(r.y1-r.y2)/2,Math.abs(r.x1-r.x2),Math.abs(r.y1-r.y2)]}function x(r,t){return f(t.x-r.x1-(r.x2-r.x1)/2,t.y-r.y1-(r.y2-r.y1)/2)}function T(r){return w(x(r,f(r.x1,r.y1)).x,x(r,f(r.x1,r.y1)).y,x(r,f(r.x2,r.y2)).x,x(r,f(r.x2,r.y2)).y)}const p={AliceBlue:s(240,248,255),AntiqueWhite:s(250,235,215),Aqua:s(0,255,255),Aquamarine:s(127,255,212),Azure:s(240,255,255),Beige:s(245,245,220),Bisque:s(255,228,196),Black:s(0,0,0),BlanchedAlmond:s(255,235,205),Blue:s(0,0,255),BlueViolet:s(138,43,226),Brown:s(165,42,42),BurlyWood:s(222,184,135),CadetBlue:s(95,158,160),Chartreuse:s(127,255,0),Chocolate:s(210,105,30),Coral:s(255,127,80),CornflowerBlue:s(100,149,237),Cornsilk:s(255,248,220),Crimson:s(220,20,60),Cyan:s(0,255,255),DarkBlue:s(0,0,139),DarkCyan:s(0,139,139),DarkGoldenRod:s(184,134,11),DarkGray:s(169,169,169),DarkGreen:s(0,100,0),DarkKhaki:s(189,183,107),DarkMagenta:s(139,0,139),DarkOliveGreen:s(85,107,47),Darkorange:s(255,140,0),DarkOrchid:s(153,50,204),DarkRed:s(139,0,0),DarkSalmon:s(233,150,122),DarkSeaGreen:s(143,188,143),DarkSlateBlue:s(72,61,139),DarkSlateGray:s(47,79,79),DarkTurquoise:s(0,206,209),DarkViolet:s(148,0,211),DeepPink:s(255,20,147),DeepSkyBlue:s(0,191,255),DimGray:s(105,105,105),DodgerBlue:s(30,144,255),FireBrick:s(178,34,34),FloralWhite:s(255,250,240),ForestGreen:s(34,139,34),Fuchsia:s(255,0,255),Gainsboro:s(220,220,220),GhostWhite:s(248,248,255),Gold:s(255,215,0),GoldenRod:s(218,165,32),Gray:s(128,128,128),Green:s(0,128,0),GreenYellow:s(173,255,47),HoneyDew:s(240,255,240),HotPink:s(255,105,180),IndianRed:s(205,92,92),Indigo:s(75,0,130),Ivory:s(255,255,240),Khaki:s(240,230,140),Lavender:s(230,230,250),LavenderBlush:s(255,240,245),LawnGreen:s(124,252,0),LemonChiffon:s(255,250,205),LightBlue:s(173,216,230),LightCoral:s(240,128,128),LightCyan:s(224,255,255),LightGoldenRodYellow:s(250,250,210),LightGrey:s(211,211,211),LightGreen:s(144,238,144),LightPink:s(255,182,193),LightSalmon:s(255,160,122),LightSeaGreen:s(32,178,170),LightSkyBlue:s(135,206,250),LightSlateGray:s(119,136,153),LightSteelBlue:s(176,196,222),LightYellow:s(255,255,224),Lime:s(0,255,0),LimeGreen:s(50,205,50),Linen:s(250,240,230),Magenta:s(255,0,255),Maroon:s(128,0,0),MediumAquaMarine:s(102,205,170),MediumBlue:s(0,0,205),MediumOrchid:s(186,85,211),MediumPurple:s(147,112,216),MediumSeaGreen:s(60,179,113),MediumSlateBlue:s(123,104,238),MediumSpringGreen:s(0,250,154),MediumTurquoise:s(72,209,204),MediumVioletRed:s(199,21,133),MidnightBlue:s(25,25,112),MintCream:s(245,255,250),MistyRose:s(255,228,225),Moccasin:s(255,228,181),NavajoWhite:s(255,222,173),Navy:s(0,0,128),OldLace:s(253,245,230),Olive:s(128,128,0),OliveDrab:s(107,142,35),Orange:s(255,165,0),OrangeRed:s(255,69,0),Orchid:s(218,112,214),PaleGoldenRod:s(238,232,170),PaleGreen:s(152,251,152),PaleTurquoise:s(175,238,238),PaleVioletRed:s(216,112,147),PapayaWhip:s(255,239,213),PeachPuff:s(255,218,185),Peru:s(205,133,63),Pink:s(255,192,203),Plum:s(221,160,221),PowderBlue:s(176,224,230),Purple:s(128,0,128),Red:s(255,0,0),RosyBrown:s(188,143,143),RoyalBlue:s(65,105,225),SaddleBrown:s(139,69,19),Salmon:s(250,128,114),SandyBrown:s(244,164,96),SeaGreen:s(46,139,87),SeaShell:s(255,245,238),Sienna:s(160,82,45),Silver:s(192,192,192),SkyBlue:s(135,206,235),SlateBlue:s(106,90,205),SlateGray:s(112,128,144),Snow:s(255,250,250),SpringGreen:s(0,255,127),SteelBlue:s(70,130,180),Tan:s(210,180,140),Teal:s(0,128,128),Thistle:s(216,191,216),Tomato:s(255,99,71),Turquoise:s(64,224,208),Violet:s(238,130,238),Wheat:s(245,222,179),White:s(255,255,255),WhiteSmoke:s(245,245,245),Yellow:s(255,255,0),YellowGreen:s(154,205,50),None:s(0,0,0,0),Transparent:s(0,0,0,0)},b={loop:!1,iterations:1,delay:0};class _{constructor(){this.queue=[],this.index=0,this.step=0}currentPackage(){return this.queue[0]}currentAnimation(){var t;return(t=this.currentPackage())==null?void 0:t.animations[this.index%this.currentPackage().animations.length]}queueIsEmpty(){return this.queue.length===0}stepForward(){return this.queueIsEmpty()?null:(this.step++,this.step>this.currentAnimation().delay+this.currentAnimation().duration+this.currentPackage().params.delay&&(this.step=0,this.index++,this.index>=this.currentPackage().animations.length*this.currentPackage().params.iterations&&(this.index=0,this.currentPackage().params.loop?this.step=0:this.queue.shift()),this.queue.length===0)?(this.index=0,this.step=0,null):this.step<this.currentAnimation().delay+this.currentPackage().params.delay?null:(this.currentAnimation().frame=Math.max(this.step-this.currentAnimation().delay-this.currentPackage().params.delay,0),this.currentAnimation().channel=this.index,this.currentAnimation()))}verifyAnimations(t,e=b){const[i,a,h]=[!!e.loop,e.iterations??1,e.delay??0];if(Array.isArray(t)||(t=[t]),t.length!==0){for(let n=0;n<t.length;n++){const o=t[n];if(o.delay??(o.delay=0),o.duration??(o.duration=60),o.easing??(o.easing=l=>l),o.name??(o.name=""),o.duration<=0)throw new Error("Animation duration must be greater than 0");o.delay<0&&(o.delay=0)}return{animations:t,params:{loop:i,iterations:a,delay:h}}}}push(t,e=b){const i=this.verifyAnimations(t,e);return i&&this.queue.push(i),this}unshift(t,e=b){const i=this.verifyAnimations(t,e);return i&&(this.queue.unshift(i),this.step=0,this.index=0),this}shift(){return this.queue.shift()}pop(){return this.queue.pop()}shiftAnimation(){var e,i;const t=(e=this.currentPackage())==null?void 0:e.animations.shift();return((i=this.currentPackage())==null?void 0:i.animations.length)===0&&this.queue.shift(),t}popAnimation(){var e,i;const t=(e=this.currentPackage())==null?void 0:e.animations.pop();return((i=this.currentPackage())==null?void 0:i.animations.length)===0&&this.queue.pop(),t}enqueue(t,e=1,i=b){return this.currentPackage()===void 0?(this.push(t,i),this):e===0?(this.clear(),this.push(t,i),this):e<=this.queue.length?(this.queue[e]=this.verifyAnimations(t,i),this):(this.push(t,i),this)}clear(){return this.queue=[],this.index=0,this.step=0,this}get animations(){return[...this.queue]}}class ${constructor(){this._children=[],this._parent=void 0,this._region=new Path2D,this.events=void 0,this.name="",this.details=void 0,this.channelCount=1,this.channels=[]}addChild(t){return t._parent=this,this._children.push(t),this}addChildren(...t){return t.forEach(e=>e._parent=this),this._children.push(...t),this}removeChild(t){return t._parent=void 0,this._children=this._children.filter(e=>e!==t),this}removeChildren(...t){return t.forEach(e=>e._parent=void 0),this._children=this._children.filter(e=>!t.includes(e)),this}}class O extends ${get bounds(){return w(this.x1,this.y1,this.x2,this.y2)}set bounds(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2}get color(){return s(this.red,this.green,this.blue)}set color(t){this.red=t.red,this.green=t.green,this.blue=t.blue}get scale(){return f(this.scaleX,this.scaleY)}set scale(t){this.scaleX=t.x,this.scaleY=t.y}get corner1(){return f(this.x1,this.y1)}set corner1(t){this.x1=t.x,this.y1=t.y}get corner2(){return f(this.x2,this.y2)}set corner2(t){this.x2=t.x,this.y2=t.y}get width(){return Math.abs(this.x2-this.x1)}set width(t){const e=(this.x1+this.x2)/2;this.x1=e-t/2,this.x2=e+t/2}get height(){return Math.abs(this.y2-this.y1)}set height(t){const e=(this.y1+this.y2)/2;this.y1=e-t/2,this.y2=e+t/2}get centerX(){return(this.x1+this.x2)/2}set centerX(t){const e=this.width;this.x1=t-e/2,this.x2=t+e/2}get centerY(){return(this.y1+this.y2)/2}set centerY(t){const e=this.height;this.y1=t-e/2,this.y2=t+e/2}get center(){return f(this.centerX,this.centerY)}set center(t){this.centerX=t.x,this.centerY=t.y}addEventListener(t,e){return this.eventListeners[t].push(e),this}on(t,e){return this.addEventListener(t,e)}removeEventListener(t,e){return e?this.eventListeners[t]=this.eventListeners[t].filter(i=>i!==e):this.eventListeners[t]=[],this}constructor(t){var e,i,a,h,n,o,l,d,c,u;super(),this.drawFunction=()=>{},this.rootPointerEventCallback=()=>{},this._region=new Path2D,this.rotation=0,this.alpha=1,this.gradient=null,this.effects=()=>{},this.name="",this.enabled=!0,this.channelCount=1,this.details=void 0,this.red=0,this.green=0,this.blue=0,this.colorAlpha=1,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.scaleX=1,this.scaleY=1,this.blur=0,this.pointerId=void 0,this.pointerButton=void 0,this.hovered=!1,this.eventListeners={click:[],drag:[],hover:[],hoverEnd:[],release:[],scroll:[],beforeDraw:[],animationFinish:[]},this.events={stage:void 0},this.name=t.name??"",this.enabled=t.enabled??!0,this.rotation=t.rotation??this.rotation,this.alpha=t.alpha??this.alpha,this.gradient=t.gradient??this.gradient,this.effects=t.effects??this.effects,this.red=((e=t.color)==null?void 0:e.red)??this.red,this.green=((i=t.color)==null?void 0:i.green)??this.green,this.blue=((a=t.color)==null?void 0:a.blue)??this.blue,this.colorAlpha=((h=t.color)==null?void 0:h.alpha)??this.colorAlpha,this.x1=((n=t.bounds)==null?void 0:n.x1)??this.x1,this.y1=((o=t.bounds)==null?void 0:o.y1)??this.y1,this.x2=((l=t.bounds)==null?void 0:l.x2)??this.x2,this.y2=((d=t.bounds)==null?void 0:d.y2)??this.y2,this.scaleX=((c=t.scale)==null?void 0:c.x)??this.scaleX,this.scaleY=((u=t.scale)==null?void 0:u.y)??this.scaleY,this.channelCount=t.channelCount??this.channelCount,this.details=t.details,this.channels=Array.from({length:this.channelCount},()=>new _)}draw(t,e,i){if(!this.enabled)return;if(i=i??!0,i&&(this.rootPointerEventCallback=()=>{}),this.animate(),t.save(),this.effects(t),t.globalAlpha=this.alpha,t.translate(Math.min(this.x1,this.x2)+this.width/2,Math.min(this.y1,this.y2)+this.height/2),t.fillStyle=this.gradient?this.gradient:R({red:this.red,green:this.green,blue:this.blue,alpha:this.colorAlpha}),this.rotation!==0&&t.rotate(this.rotation*Math.PI/180),(this.scaleX!==1||this.scaleY!==1)&&t.scale(this.scaleX,this.scaleY),this.blur!==0&&(t.filter=`blur(${this.blur}px)`),this.events.stage){const h=this.events.stage;this.eventListeners.beforeDraw.forEach(n=>{n.call(this,h.currentFrame)})}const a=this.drawFunction(t,e);a!==void 0&&(this._region=a),this._children.forEach(h=>{h.events=this.events,h.draw(t,void 0,!1)}),this.handlePointerEvents(t)||t.restore(),i&&this.rootPointerEventCallback()}handlePointerEvents(t){let e=!1;if(this.events===void 0||!this.events.down&&!this.events.up&&!this.events.move||[this.eventListeners.click,this.eventListeners.drag,this.eventListeners.hover,this.eventListeners.hoverEnd,this.eventListeners.release].every(h=>h.length===0))return!1;const i=[this.events.down,this.events.up,this.events.move].every(h=>h===void 0||this.pointIsInPath(t,h.translatedPoint.x,h.translatedPoint.y));if(this.eventListeners.hover.length>0&&!this.hovered&&i)this.eventListeners.hover.forEach(h=>{var n,o,l,d;return h.call(this,((n=this.events.move)==null?void 0:n.event)??((o=this.events.down)==null?void 0:o.event)??this.events.up.event,((l=this.events.move)==null?void 0:l.translatedPoint)??((d=this.events.down)==null?void 0:d.translatedPoint)??this.events.up.translatedPoint)}),this.hovered=!0;else if(!i&&this.hovered){if(this.eventListeners.hoverEnd.length>0){const h=[this.events.down,this.events.up,this.events.move].find(n=>n!==void 0&&!this.pointIsInPath(t,n.translatedPoint.x,n.translatedPoint.y));this.eventListeners.hoverEnd.forEach(n=>{n.call(this,h.event,h.translatedPoint)})}this.hovered=!1}const a=(h,n,o,l,d)=>{const{event:c,translatedPoint:u}=n,v=h.getTransform().inverse().transformPoint(u),y=h.getTransform(),g=()=>{h.save(),h.setTransform(y.a,y.b,y.c,y.d,y.e,y.f),d.forEach(k=>k.call(l,c,v)),h.restore()};o.rootPointerEventCallback=g.bind(this)};if(this.events.move&&!this.events.up&&!this.events.down&&this.pointerId!==void 0&&this.eventListeners.drag.length>0&&(t.restore(),e=!0,a(t,this.events.move,this.root,this,this.eventListeners.drag)),this.events.up){if(t.restore(),e=!0,this.eventListeners.release.length>0&&this.pointerId!==void 0){const h=this.events.up;a(t,h,this.root,this,this.eventListeners.release)}this.pointerId=void 0}else if(this.events.down&&i){t.restore(),e=!0;const h=this.events.down;this.pointerId=h.event.pointerId,this.pointerButton=h.event.button,this.eventListeners.click.length>0&&a(t,h,this.root,this,this.eventListeners.click)}return e}pointIsInPath(t,e,i){return t.isPointInPath(this._region,e,i)}static initializeProps(t){return{color:t.color??s(0,0,0),alpha:t.alpha??1,rotation:t.rotation??0,scale:t.scale??f(1,1),bounds:t.bounds??w(0,0,0,0),name:t.name??"",effects:t.effects??(()=>{})}}get children(){return[...this._children]}get parent(){return this._parent}get root(){return this._parent===void 0?this:this._parent.root}logHierarchy(t=0){const e=this.name===""?this.constructor.name:this.name,i=[this.red,this.green,this.blue].every(n=>n<25)?125:this.red,a=[this.red,this.green,this.blue].every(n=>n<25)?125:this.green,h=[this.red,this.green,this.blue].every(n=>n<25)?125:this.blue;console.log(`%c${"	".repeat(t)} ⌞${e} 	{ ${this.constructor.name} @ (${this.x1}, ${this.y1}) (${this.x2}, ${this.y2}) }`,`color: ${R(s(i,a,h))}; font-weight: bold;`),this._children.forEach(n=>n.logHierarchy(t+1))}distribute(t,e={loop:!1,iterations:1,delay:0}){if(t.length>this.channels.length)throw new Error(`Cannot distribute ${t.length} animations to ${this.channels.length} channels`);for(let i=0;i<t.length;i++){const a=t[i];this.channels[i%this.channels.length].push(a,e)}return this}set(t,e){return this[t]=e,!0}animate(){const t=this.channels.map(e=>e.stepForward()).filter(e=>e!==null);for(const e of t.reverse())this.animateProperty(e);return this}animateProperty(t){if((t._from===void 0||t.frame===0)&&(t.from===null?t._from=this[t.property]:t._from=t.from),t._to===void 0||t.frame===0)if(typeof t.to=="function"){const o=t.to;t._to=o(t._from)}else t._to=t.to;const[e,i,a,h,n]=[t._from,t._to,t.frame??0,t.duration,t.easing];if(typeof this[t.property]=="number"&&typeof e=="number"&&typeof i=="number")this.set(t.property,e+n(a/h)*(i-e));else if(typeof this[t.property]=="object"){(typeof e!="object"||typeof i!="object")&&this.raiseAnimationError(e,i,t.property);const o={...i};for(const l of Object.keys(i)){const d=e[l],c=i[l];(d===void 0||c===void 0)&&this.raiseAnimationError(e,i,l),o[l]=d+n(a/h)*(c-d)}this.set(t.property,o)}else throw new Error(`Property ${t.property} is not a valid property`);t.frame===t.duration&&this.eventListeners.animationFinish.forEach(o=>o.call(this,t))}raiseAnimationError(t,e,i){throw new Error(`${t} -> ${e} is not a valid animation for property ${i}`)}setPointerEvents(t){return this.events=t,this}r_setPointerEvents(t){return this.setPointerEvents(t),this._children.forEach(e=>e.r_setPointerEvents(t)),this}createChannels(t){return this.channels.push(...Array.from({length:t},()=>new _)),this}findChild(t){return this._children.find(e=>e.name===t)}findChildren(t){return this._children.filter(e=>e.name===t)}r_findChild(t){return this._children.find(e=>e.name===t)??this._children.map(e=>e.r_findChild(t)).find(e=>e!==void 0)}r_findChildren(t){return this._children.filter(e=>e.name===t)??this._children.map(e=>e.r_findChildren(t)).flat()}r_getChildren(){const t=[...this._children];return this._children.forEach(e=>t.push(...e.r_getChildren())),t}addChild(t){return super.addChild(t),this}addChildren(...t){return super.addChildren(...t),this}removeChild(t){return super.removeChild(t),this}removeChildren(...t){return super.removeChildren(...t),this}hasEventListeners(){return Object.values(this.eventListeners).some(t=>t.length>0)}spriteOrChildrenHaveEventListeners(){return this.hasEventListeners()?!0:this._children.some(t=>t.spriteOrChildrenHaveEventListeners())}copy(){const t=structuredClone({...this,_children:void 0,_parent:void 0,_region:void 0,events:void 0,rootPointerEventCallback:void 0,drawFunction:void 0,effects:void 0,channels:void 0,eventListeners:void 0}),e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(t));e.eventListeners={};for(const[i,a]of Object.entries(this.eventListeners))e.eventListeners[i]=a.map(h=>h.bind(e));return e.channels=this.channels.map(function(){return new _}),e._children=this._children.map(i=>i.copy()),e._parent=void 0,e.rootPointerEventCallback=()=>{},e.drawFunction=this.drawFunction,e.effects=this.effects.bind(e),e}}class I extends O{constructor(t){var e,i,a,h;t.bounds=w(((e=t.position)==null?void 0:e.x)??0,((i=t.position)==null?void 0:i.y)??0,((a=t.position)==null?void 0:a.x)??0,((h=t.position)==null?void 0:h.y)??0),t.color={red:0,green:0,blue:0,alpha:0},t.position??(t.position=f(0,0)),super(t)}get position(){return f(this.positionX,this.positionY)}set position(t){this.positionX=t.x,this.positionY=t.y}get positionX(){return this.centerX}set positionX(t){this.x1=t,this.x2=t}get positionY(){return this.centerY}set positionY(t){this.y1=t,this.y2=t}pointIsInPath(){return!1}}class C extends O{constructor(t){var e,i,a,h,n,o,l,d,c,u,v,y,g,k,B;super(t),this.strokeRed=0,this.strokeGreen=0,this.strokeBlue=0,this.strokeAlpha=1,this.strokeWidth=1,this.strokeJoin="miter",this.strokeCap="butt",this.strokeDash=0,this.strokeDashGap=0,this.strokeOffset=0,this.strokeEnabled=!1,this.strokeRed=((i=(e=t.stroke)==null?void 0:e.color)==null?void 0:i.red)??0,this.strokeGreen=((h=(a=t.stroke)==null?void 0:a.color)==null?void 0:h.green)??0,this.strokeBlue=((o=(n=t.stroke)==null?void 0:n.color)==null?void 0:o.blue)??0,this.strokeAlpha=((d=(l=t.stroke)==null?void 0:l.color)==null?void 0:d.alpha)??1,this.strokeWidth=((c=t.stroke)==null?void 0:c.lineWidth)??1,this.strokeJoin=((u=t.stroke)==null?void 0:u.lineJoin)??"miter",this.strokeCap=((v=t.stroke)==null?void 0:v.lineCap)??"butt",this.strokeDash=((y=t.stroke)==null?void 0:y.lineDash)??0,this.strokeDashGap=((g=t.stroke)==null?void 0:g.lineDashGap)??((k=t.stroke)==null?void 0:k.lineDash)??0,this.strokeOffset=((B=t.stroke)==null?void 0:B.lineDashOffset)??0,this.strokeEnabled=t.stroke!==null&&t.stroke!==void 0}get stroke(){return this.strokeEnabled?{color:{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha},lineWidth:this.strokeWidth,lineJoin:this.strokeJoin,lineCap:this.strokeCap,lineDash:this.strokeDash,lineDashGap:this.strokeDashGap,lineDashOffset:this.strokeOffset}:null}set stroke(t){var e,i,a,h;this.strokeEnabled=t!==null,t!==null&&(this.strokeRed=((e=t.color)==null?void 0:e.red)??0,this.strokeGreen=((i=t.color)==null?void 0:i.green)??0,this.strokeBlue=((a=t.color)==null?void 0:a.blue)??0,this.strokeAlpha=((h=t.color)==null?void 0:h.alpha)??1,this.strokeWidth=t.lineWidth??1,this.strokeJoin=t.lineJoin??"miter",this.strokeCap=t.lineCap??"butt",this.strokeDash=t.lineDash??0,this.strokeDashGap=t.lineDashGap??t.lineDash??0,this.strokeOffset=t.lineDashOffset??0)}get strokeColor(){return{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha}}set strokeColor(t){this.strokeRed=t.red,this.strokeGreen=t.green,this.strokeBlue=t.blue,this.strokeAlpha=t.alpha}draw(t,e){super.draw(t,{...e,stroke:this.strokeEnabled?{color:{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha},lineWidth:this.strokeWidth,lineJoin:this.strokeJoin,lineCap:this.strokeCap,lineDash:this.strokeDash,lineDashGap:this.strokeDashGap,lineDashOffset:this.strokeOffset}:null})}}class M extends C{constructor(t){super(t),this.radius=[0],this.drawFunction=M.drawFunction,this.radius=t.radius??[0]}draw(t){super.draw(t,{bounds:this.bounds,radius:this.radius})}static Bounds(t,e,i,a){return X(t,e,i,a)}}M.drawFunction=(r,t)=>{var c;const e=T(t.bounds??w(0,0,0,0));if(t.stroke===null||((c=t.stroke)==null?void 0:c.lineWidth)===0)if(t.radius&&t.radius[0]===0&&t.radius.length===1){const u=new Path2D;return u.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),r.fill(u,"nonzero"),u}else{const u=new Path2D;return u.roundRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t.radius),r.fill(u,"nonzero"),u}const{color:i,lineWidth:a,lineJoin:h,lineCap:n,lineDash:o,lineDashGap:l,lineDashOffset:d}=t.stroke;if(r.lineWidth=a??1,r.lineJoin=h??"miter",r.lineCap=n??"round",r.strokeStyle=`rgba(${(i==null?void 0:i.red)??0}, ${(i==null?void 0:i.green)??0}, ${(i==null?void 0:i.blue)??0}, ${(i==null?void 0:i.alpha)??1})`,r.setLineDash([o??0,l??0]),r.lineDashOffset=d??0,o===0){const u=new Path2D;return u.roundRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t.radius),r.fill(u,"nonzero"),r.stroke(u),u}else{const u=new Path2D;return u.roundRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t.radius),r.fill(u,"nonzero"),r.stroke(u),u}};class q extends C{constructor(t){var a,h;super(t),this.startAngle=0,this.endAngle=360,this.drawFunction=(n,o)=>{var y;const[l,d]=typeof o.radius=="number"?[o.radius,o.radius]:o.radius??[5,5],c=G(o.center.x,o.center.y,l,d),u=F(c);n.beginPath();const v=new Path2D;if(v.ellipse(0,0,u[2]/2,u[3]/2,0,(o.startAngle??0)*Math.PI/180,(o.endAngle??0)*Math.PI/180),v.closePath(),n.fill(v,"nonzero"),n.closePath(),o.stroke!==null&&((y=o.stroke)==null?void 0:y.lineWidth)!==0){const{color:g,lineWidth:k,lineJoin:B,lineCap:j,lineDash:N,lineDashGap:V,lineDashOffset:U}=o.stroke;n.lineWidth=k??1,n.lineJoin=B??"miter",n.lineCap=j??"round",n.strokeStyle=`rgba(${(g==null?void 0:g.red)??0}, ${(g==null?void 0:g.green)??0}, ${(g==null?void 0:g.blue)??0}, ${(g==null?void 0:g.alpha)??1})`,n.setLineDash([N??0,V??0]),n.lineDashOffset=U??0,n.stroke(v)}return v},this.startAngle=t.startAngle??0,this.endAngle=t.endAngle??360;const e=typeof t.radius=="number"?[t.radius,t.radius]:t.radius??[5,5];this.radiusX=e[0],this.radiusY=e[1];const i=G(((a=t.center)==null?void 0:a.x)??0,((h=t.center)==null?void 0:h.y)??0,e[0],e[1]);this.x1=i.x1,this.y1=i.y1,this.x2=i.x2,this.y2=i.y2}get radius(){return[this.radiusX,this.radiusY]}set radius(t){typeof t=="number"?(this.radiusX=t,this.radiusY=t):(this.radiusX=t[0],this.radiusY=t[1])}get radiusX(){return this.width/2}set radiusX(t){this.width=t*2}get radiusY(){return this.height/2}set radiusY(t){this.height=t*2}draw(t){super.draw(t,{center:{x:this.centerX,y:this.centerY},radius:[this.radiusX,this.radiusY],startAngle:this.startAngle,endAngle:this.endAngle})}}class m extends C{constructor(t){super(t),this.path=[],this.closePath=!1,this.fillRule="nonzero",this.startRatio=0,this.endRatio=1,this.drawFunction=m.drawFunction,this.path=t.path??[],this.closePath=t.closePath??!1,this.fillRule=t.fillRule??"nonzero",this.startRatio=t.startRatio??0,this.endRatio=t.endRatio??1;const e=m.getBoundsFromPath(this.path);this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}get bounds(){return m.getBoundsFromPath(this.path)}set bounds(t){throw new Error("Bounds cannot be set on Path")}draw(t){const e=m.getBoundsFromPath(this.path);this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,super.draw(t,{path:this.path,closePath:this.closePath,fillRule:this.fillRule,startRatio:this.startRatio,endRatio:this.endRatio})}static getPathSegment(t,e,i){if(e===0&&i===1)return t;if(e===i)return[];if(e>i)return m.getPathSegment(t,i,e).reverse();if(e<0||i>1)throw new Error("Start and end must be between 0 and 1");const a=t.map((d,c)=>m.calculateDistance(d,t[c+1]??t[0]));a.pop();const h=a.reduce((d,c)=>d+c,0),n=[];let o=0,l=0;for(const d of a){const c=d/h;if(l+c<e){l+=c,o++;continue}let u=0;l+c>e&&l<e&&(u=(e-l)*(1/c));let v=1;if(l+c>i&&l<i&&(v=(i-l)*(1/c)),l+c>e&&n.push(m.interpolate(t[o],t[o+1]??t[0],u)),l<i&&l+c>i)return n.push(m.interpolate(t[o],t[o+1]??t[0],v)),n;l+=c,o++}return i===1?n.concat(t[t.length-1]):n}static interpolate(t,e,i){return f(t.x+i*(e.x-t.x),t.y+i*(e.y-t.y))}static calculateDistance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static getBoundsFromPath(t){return w(Math.min(...t.map(e=>e.x)),Math.min(...t.map(e=>e.y)),Math.max(...t.map(e=>e.x)),Math.max(...t.map(e=>e.y)))}}m.drawFunction=(r,t)=>{var a,h;let e=((a=t.path)==null?void 0:a.map(n=>x(m.getBoundsFromPath(t.path??[]),n)))??[];if(e=m.getPathSegment(e,t.startRatio??0,t.endRatio??1),e.length===0)return new Path2D;const i=new Path2D;i.moveTo(e[0].x,e[0].y);for(const n of e.slice(1))i.lineTo(n.x,n.y);if(t.closePath&&i.closePath(),r.fill(i,t.fillRule??"nonzero"),t.stroke!==null&&((h=t.stroke)==null?void 0:h.lineWidth)!==0){const{color:n,lineWidth:o,lineJoin:l,lineCap:d,lineDash:c,lineDashGap:u,lineDashOffset:v}=t.stroke;r.lineWidth=o??1,r.lineJoin=l??"miter",r.lineCap=d??"round",r.strokeStyle=`rgba(${(n==null?void 0:n.red)??0}, ${(n==null?void 0:n.green)??0}, ${(n==null?void 0:n.blue)??0}, ${(n==null?void 0:n.alpha)??1})`,r.setLineDash([c??0,u??0]),r.lineDashOffset=v??0,r.stroke(i)}return i};class D extends C{constructor(t){var e,i;super(t),this.text="",this.positionIsCenter=!1,this.font="sans-serif",this.fontSize=16,this.bold=!1,this.italic=!1,this.textAlign="start",this.textBaseline="alphabetic",this.textDirection="inherit",this.maxWidth=null,this.positionX=0,this.positionY=0,this.drawFunction=D.drawFunction,this.text=t.text??"",this.positionX=((e=t.position)==null?void 0:e.x)??0,this.positionY=((i=t.position)==null?void 0:i.y)??0,this.positionIsCenter=t.positionIsCenter??!1,this.font=t.font??"sans-serif",this.fontSize=t.fontSize??16,this.textAlign=t.textAlign??"start",this.textBaseline=t.textBaseline??"alphabetic",this.textDirection=t.textDirection??"inherit",this.maxWidth=t.maxWidth??null,this.bold=t.bold??!1,this.italic=t.italic??!1}get position(){return f(this.positionX,this.positionY)}set position(t){this.positionX=t.x,this.positionY=t.y}draw(t){var n,o;((n=this.root.stage)==null?void 0:n.rootStyle)==="centered"&&(this.scaleY*=-1),t.font=`${this.bold?"bold ":""}${this.italic?"italic ":""}${this.fontSize}px ${this.font}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.direction=this.textDirection;const e=t.measureText(this.text),i=e.width,a=e.actualBoundingBoxAscent,h=this.fontSize;this.positionIsCenter?(this.x1=this.positionX-i/2,this.y1=this.positionY-h/2+(this.fontSize-a),this.x2=this.positionX+i/2,this.y2=this.positionY+h/2):(this.x1=this.positionX,this.y1=this.positionY,this.x2=this.positionX+i,this.y2=this.positionY+h),super.draw(t,{text:this.text,position:f(this.positionX,this.positionY),font:this.font,fontSize:this.fontSize,textAlign:this.textAlign,textBaseline:this.textBaseline,textDirection:this.textDirection,maxWidth:this.maxWidth,bold:this.bold,italic:this.italic,positionIsCenter:this.positionIsCenter}),((o=this.root.stage)==null?void 0:o.rootStyle)==="centered"&&(this.scaleY*=-1)}}D.drawFunction=(r,t)=>{var l;const{text:e,maxWidth:i}=t,a=r.measureText(e??""),h=a.width,n=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent;if(r.fillText(e??"",-h/2,n/2,i??void 0),t.stroke!==null&&((l=t.stroke)==null?void 0:l.lineWidth)!==0){const{color:d,lineWidth:c,lineJoin:u,lineCap:v,lineDash:y,lineDashGap:g,lineDashOffset:k}=t.stroke;r.lineWidth=c??1,r.lineJoin=u??"miter",r.lineCap=v??"round",r.strokeStyle=`rgba(${(d==null?void 0:d.red)??0}, ${(d==null?void 0:d.green)??0}, ${(d==null?void 0:d.blue)??0}, ${(d==null?void 0:d.alpha)??1})`,r.setLineDash([y??0,g??0]),r.lineDashOffset=k??0,r.strokeText(e??"",-h/2,n/2,i??void 0)}const o=new Path2D;return o.moveTo(-h/2,-n/2),o.lineTo(h/2,-n/2),o.lineTo(h/2,n/2),o.lineTo(-h/2,n/2),o.closePath(),o};class W extends I{constructor(t,e){super(e),this.stage=t}}class H{constructor(t,e="centered",i=p.White,a,h=!1){if(this.canvas=t,this.rootStyle=e,this.bgColor=i,this.active=!1,this.nextRenderTime=void 0,this.frameRate=60,this.lastRenderMs=0,this.currentFrame=0,this.drawEvents={},this.onError=n=>{console.error(n)},this.eventListeners={beforeDraw:[],click:[],release:[],move:[],scroll:[]},!t)throw new Error("No canvas element provided");this._root=e==="classic"?new W(this,{}):new W(this,{position:f(this.width/2,this.height/2),scale:f(1,-1)}),t.oncontextmenu=()=>!1,t.style.touchAction="none",this.ctx=a??(h?void 0:t.getContext("2d"))}get root(){return this._root}addEventListener(t,e){this.eventListeners[t].push(e)}on(t,e){this.addEventListener(t,e)}removeEventListener(t,e){this.eventListeners[t]=this.eventListeners[t].filter(i=>i!==e)}pointerDownHandler(t){if(!this.active)return;t.preventDefault();const e=f((t.offsetX||t.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((t.offsetY||t.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));this.eventListeners.click.forEach(i=>i.call(this,t,e)),this.drawEvents.down={event:t,translatedPoint:this.positionOnCanvas(this.canvas,t)}}pointerUpHandler(t){if(!this.active)return;t.preventDefault();const e=f((t.offsetX||t.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((t.offsetY||t.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));this.eventListeners.release.forEach(i=>i.call(this,t,e)),this.drawEvents.up={event:t,translatedPoint:this.positionOnCanvas(this.canvas,t)}}pointerMoveHandler(t){if(!this.active)return;t.preventDefault();const e=f((t.offsetX||t.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((t.offsetY||t.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));this.eventListeners.move.forEach(i=>i.call(this,t,e)),this.drawEvents.move={event:t,translatedPoint:this.positionOnCanvas(this.canvas,t)}}wheelHandler(t){this.active&&(this.eventListeners.scroll.forEach(e=>e.call(this,t)),t.preventDefault())}positionOnCanvas(t,e){return f((e.offsetX||e.clientX-t.getBoundingClientRect().left)*t.width/t.clientWidth,(e.offsetY||e.clientY-t.getBoundingClientRect().top)*t.height/t.clientHeight)}loop(t=60){this.stop(),this.canvas.addEventListener("pointerdown",this.pointerDownHandler.bind(this)),this.canvas.addEventListener("pointerup",this.pointerUpHandler.bind(this)),this.canvas.addEventListener("pointermove",this.pointerMoveHandler.bind(this)),this.canvas.addEventListener("wheel",this.wheelHandler.bind(this)),this.active=!0,this.frameRate=t,this.nextRenderTime=performance.now(),this.currentFrame=0,requestAnimationFrame(this.drawLoop.bind(this))}drawLoop(){const t=performance.now();if(this.nextRenderTime&&t<this.nextRenderTime){requestAnimationFrame(this.drawLoop.bind(this));return}this.nextRenderTime=t+800/this.frameRate,this.active&&(this.draw(this.ctx),this.lastRenderMs=performance.now()-t,requestAnimationFrame(this.drawLoop.bind(this)))}draw(t){t??(t=this.ctx),this.eventListeners.beforeDraw.forEach(e=>e.call(this,this.currentFrame)),this.root.setPointerEvents(this.drawEvents),t.fillStyle=R(this.bgColor),t.fillRect(0,0,this.width??0,this.height??0),this.drawEvents.stage=this;try{this.root.draw(t)}catch(e){this.stop(),this.onError(e)}this.drawEvents={stage:this},this.currentFrame++}stop(){this.canvas.removeEventListener("pointerdown",this.pointerDownHandler.bind(this)),this.canvas.removeEventListener("pointerup",this.pointerUpHandler.bind(this)),this.canvas.removeEventListener("pointermove",this.pointerMoveHandler.bind(this)),this.canvas.removeEventListener("wheel",this.wheelHandler.bind(this)),this.active=!1}get width(){var t;return(t=this.canvas)==null?void 0:t.width}get height(){var t;return(t=this.canvas)==null?void 0:t.height}get scaleX(){return(this.width??0)/this.canvas.clientWidth}get scaleY(){return(this.height??0)/this.canvas.clientHeight}}const z={width:0,height:0,oncontextmenu:()=>!1,style:{touchAction:"none"},getContext:()=>null,offsetLeft:0,offsetTop:0,addEventListener:()=>{},clientWidth:0,clientHeight:0,getBoundingClientRect:()=>({top:0,left:0}),removeEventListener:()=>{},transferToImageBitmap:()=>{}};class J extends H{constructor(t,e="centered",i=p.White){const a=new OffscreenCanvas(1,1);super(z,e,i,a.getContext("2d")),this._postMessage=t,this.rootStyle=e,this.bgColor=i,this.eventListeners={beforeDraw:[],click:[],release:[],move:[],scroll:[],message:[]},this.onError=function(h){this.postMessage({type:"error",error:(h==null?void 0:h.message)??"Error"})},this.informOffscreenOfStop=!0,this.onmessage=h=>{this.eventListeners.message.forEach(o=>o.call(this,h.data));const n=h.data;switch(n.type){case"init":this.canvas.height=n.height,this.canvas.offsetLeft=0,this.canvas.offsetTop=0,this.offscreenCanvas.width=n.width,this.offscreenCanvas.height=n.height,this._root.position=this.rootStyle==="centered"?f(n.width/2,n.height/2):f(0,0),this.postMessage({type:"ready"}),this.loop();break;case"beginLoop":this.setStageState({...n.stageState,type:"stageState"}),this.loop(n.frameRate*1.25);break;case"stageState":this.setStageState(n);break;case"stopLoop":this.stop();break}},this.offscreenCanvas=a}addEventListener(t,e){this.eventListeners[t].push(e)}on(t,e){this.addEventListener(t,e)}removeEventListener(t,e){this.eventListeners[t]=this.eventListeners[t].filter(i=>i!==e)}setStageState(t){var e,i,a;this.nextDrawEvents??(this.nextDrawEvents={}),(e=this.nextDrawEvents).up??(e.up=t.events.up),(i=this.nextDrawEvents).down??(i.down=t.events.down),(a=this.nextDrawEvents).move??(a.move=t.events.move),this.canvas.width=t.canvasProperties.width,this.canvas.height=t.canvasProperties.height,this.canvas.offsetLeft=t.canvasProperties.offsetLeft,this.canvas.offsetTop=t.canvasProperties.offsetTop,this.canvas.clientWidth=t.canvasProperties.clientWidth,this.canvas.clientHeight=t.canvasProperties.clientHeight,this.canvas.getBoundingClientRect=()=>t.canvasProperties.boundingClientRect}draw(t){this.drawEvents=this.nextDrawEvents?JSON.parse(JSON.stringify(this.nextDrawEvents)):this.drawEvents,this.eventListeners.beforeDraw.forEach(h=>h.call(this,this.currentFrame));const{down:e,up:i,move:a}=this.drawEvents;e&&this.eventListeners.click.forEach(h=>h.call(this,e.event,e.translatedPoint)),i&&this.eventListeners.release.forEach(h=>h.call(this,i.event,i.translatedPoint)),a&&this.eventListeners.move.forEach(h=>h.call(this,a.event,a.translatedPoint)),this.eventListeners.beforeDraw.forEach(h=>h.call(this,this.currentFrame)),super.draw(t),this.postMessage({type:"render",img:this.offscreenCanvas.transferToImageBitmap(),lastRenderMs:this.lastRenderMs,currentFrame:this.currentFrame}),this.nextDrawEvents=void 0}postCustomMessage(t,e){this.postMessage({type:"custom",message:t},e)}postMessage(t,e){if(!e){this._postMessage(t);return}e.postMessage(t)}loop(t=60){this.informOffscreenOfStop=!1,super.loop(t),this.informOffscreenOfStop=!0}stop(){super.stop(),this.informOffscreenOfStop&&this.postMessage({type:"stopLoop",source:"worker"})}}const L=new J(postMessage.bind(null),"centered",p.LightSlateGray);onmessage=L.onmessage;const P=new q({color:p.Red,radius:75,center:{x:-100,y:100},stroke:{lineWidth:5},details:"red"}),E=P.copy();E.color=p.Green,E.center={x:100,y:100},E.details="green";const S=P.copy();S.color=p.Yellow,S.center={x:-100,y:-100},S.details="yellow";const A=P.copy();A.color=p.Aqua,A.center={x:100,y:-100},A.details="blue";const Y=new D({text:"Click a circle!",position:{x:0,y:0},positionIsCenter:!0,fontSize:30,bold:!0,color:p.White});[P,E,S,A].forEach(r=>{r.on("click",function(){L.postCustomMessage(this.details),Y.text=`You clicked the ${this.details} circle!`,Y.color=this.color}),L.root.addChild(r)}),L.root.addChild(Y)})();
