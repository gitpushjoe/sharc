(function(){"use strict";function f(h,e){return{x:h,y:e}}function Y(h){return`rgba(${h.red}, ${h.green}, ${h.blue}, ${h.alpha})`}function i(h,e,t,s=1){return{red:h,green:e,blue:t,alpha:s}}function w(h,e,t,s){return{x1:h,y1:e,x2:t,y2:s}}function T(h,e,t,s){return{x1:h,y1:e,x2:h+t,y2:e+s}}function X(h,e,t,s){return{x1:h-t,y1:e-(s??t),x2:h+t,y2:e+(s??t)}}function _(h){return[-Math.abs(h.x1-h.x2)/2,-Math.abs(h.y1-h.y2)/2,Math.abs(h.x1-h.x2),Math.abs(h.y1-h.y2)]}function x(h,e){return f(e.x-h.x1-(h.x2-h.x1)/2,e.y-h.y1-(h.y2-h.y1)/2)}function F(h){return w(x(h,f(h.x1,h.y1)).x,x(h,f(h.x1,h.y1)).y,x(h,f(h.x2,h.y2)).x,x(h,f(h.x2,h.y2)).y)}const k={AliceBlue:i(240,248,255),AntiqueWhite:i(250,235,215),Aqua:i(0,255,255),Aquamarine:i(127,255,212),Azure:i(240,255,255),Beige:i(245,245,220),Bisque:i(255,228,196),Black:i(0,0,0),BlanchedAlmond:i(255,235,205),Blue:i(0,0,255),BlueViolet:i(138,43,226),Brown:i(165,42,42),BurlyWood:i(222,184,135),CadetBlue:i(95,158,160),Chartreuse:i(127,255,0),Chocolate:i(210,105,30),Coral:i(255,127,80),CornflowerBlue:i(100,149,237),Cornsilk:i(255,248,220),Crimson:i(220,20,60),Cyan:i(0,255,255),DarkBlue:i(0,0,139),DarkCyan:i(0,139,139),DarkGoldenRod:i(184,134,11),DarkGray:i(169,169,169),DarkGreen:i(0,100,0),DarkKhaki:i(189,183,107),DarkMagenta:i(139,0,139),DarkOliveGreen:i(85,107,47),Darkorange:i(255,140,0),DarkOrchid:i(153,50,204),DarkRed:i(139,0,0),DarkSalmon:i(233,150,122),DarkSeaGreen:i(143,188,143),DarkSlateBlue:i(72,61,139),DarkSlateGray:i(47,79,79),DarkTurquoise:i(0,206,209),DarkViolet:i(148,0,211),DeepPink:i(255,20,147),DeepSkyBlue:i(0,191,255),DimGray:i(105,105,105),DodgerBlue:i(30,144,255),FireBrick:i(178,34,34),FloralWhite:i(255,250,240),ForestGreen:i(34,139,34),Fuchsia:i(255,0,255),Gainsboro:i(220,220,220),GhostWhite:i(248,248,255),Gold:i(255,215,0),GoldenRod:i(218,165,32),Gray:i(128,128,128),Green:i(0,128,0),GreenYellow:i(173,255,47),HoneyDew:i(240,255,240),HotPink:i(255,105,180),IndianRed:i(205,92,92),Indigo:i(75,0,130),Ivory:i(255,255,240),Khaki:i(240,230,140),Lavender:i(230,230,250),LavenderBlush:i(255,240,245),LawnGreen:i(124,252,0),LemonChiffon:i(255,250,205),LightBlue:i(173,216,230),LightCoral:i(240,128,128),LightCyan:i(224,255,255),LightGoldenRodYellow:i(250,250,210),LightGrey:i(211,211,211),LightGreen:i(144,238,144),LightPink:i(255,182,193),LightSalmon:i(255,160,122),LightSeaGreen:i(32,178,170),LightSkyBlue:i(135,206,250),LightSlateGray:i(119,136,153),LightSteelBlue:i(176,196,222),LightYellow:i(255,255,224),Lime:i(0,255,0),LimeGreen:i(50,205,50),Linen:i(250,240,230),Magenta:i(255,0,255),Maroon:i(128,0,0),MediumAquaMarine:i(102,205,170),MediumBlue:i(0,0,205),MediumOrchid:i(186,85,211),MediumPurple:i(147,112,216),MediumSeaGreen:i(60,179,113),MediumSlateBlue:i(123,104,238),MediumSpringGreen:i(0,250,154),MediumTurquoise:i(72,209,204),MediumVioletRed:i(199,21,133),MidnightBlue:i(25,25,112),MintCream:i(245,255,250),MistyRose:i(255,228,225),Moccasin:i(255,228,181),NavajoWhite:i(255,222,173),Navy:i(0,0,128),OldLace:i(253,245,230),Olive:i(128,128,0),OliveDrab:i(107,142,35),Orange:i(255,165,0),OrangeRed:i(255,69,0),Orchid:i(218,112,214),PaleGoldenRod:i(238,232,170),PaleGreen:i(152,251,152),PaleTurquoise:i(175,238,238),PaleVioletRed:i(216,112,147),PapayaWhip:i(255,239,213),PeachPuff:i(255,218,185),Peru:i(205,133,63),Pink:i(255,192,203),Plum:i(221,160,221),PowderBlue:i(176,224,230),Purple:i(128,0,128),Red:i(255,0,0),RosyBrown:i(188,143,143),RoyalBlue:i(65,105,225),SaddleBrown:i(139,69,19),Salmon:i(250,128,114),SandyBrown:i(244,164,96),SeaGreen:i(46,139,87),SeaShell:i(255,245,238),Sienna:i(160,82,45),Silver:i(192,192,192),SkyBlue:i(135,206,235),SlateBlue:i(106,90,205),SlateGray:i(112,128,144),Snow:i(255,250,250),SpringGreen:i(0,255,127),SteelBlue:i(70,130,180),Tan:i(210,180,140),Teal:i(0,128,128),Thistle:i(216,191,216),Tomato:i(255,99,71),Turquoise:i(64,224,208),Violet:i(238,130,238),Wheat:i(245,222,179),White:i(255,255,255),WhiteSmoke:i(245,245,245),Yellow:i(255,255,0),YellowGreen:i(154,205,50),None:i(0,0,0,0),Transparent:i(0,0,0,0)},b={loop:!1,iterations:1,delay:0};class W{constructor(){this.queue=[],this.index=0,this.step=0}currentPackage(){return this.queue[0]}currentAnimation(){var e;return(e=this.currentPackage())==null?void 0:e.animations[this.index%this.currentPackage().animations.length]}queueIsEmpty(){return this.queue.length===0}stepForward(){return this.queueIsEmpty()?null:(this.step++,this.step>this.currentAnimation().delay+this.currentAnimation().duration+this.currentPackage().params.delay&&(this.step=0,this.index++,this.index>=this.currentPackage().animations.length*this.currentPackage().params.iterations&&(this.index=0,this.currentPackage().params.loop?this.step=0:this.queue.shift()),this.queue.length===0)?(this.index=0,this.step=0,null):this.step<this.currentAnimation().delay+this.currentPackage().params.delay?null:(this.currentAnimation().frame=Math.max(this.step-this.currentAnimation().delay-this.currentPackage().params.delay,0),this.currentAnimation().channel=this.index,this.currentAnimation()))}verifyAnimations(e,t=b){const[s,a,n]=[!!t.loop,t.iterations??1,t.delay??0];if(Array.isArray(e)||(e=[e]),e.length!==0){for(let r=0;r<e.length;r++){const o=e[r];if(o.delay??(o.delay=0),o.duration??(o.duration=60),o.easing??(o.easing=l=>l),o.name??(o.name=""),o.duration<=0)throw new Error("Animation duration must be greater than 0");o.delay<0&&(o.delay=0)}return{animations:e,params:{loop:s,iterations:a,delay:n}}}}push(e,t=b){const s=this.verifyAnimations(e,t);return s&&this.queue.push(s),this}unshift(e,t=b){const s=this.verifyAnimations(e,t);return s&&(this.queue.unshift(s),this.step=0,this.index=0),this}shift(){return this.queue.shift()}pop(){return this.queue.pop()}shiftAnimation(){var t,s;const e=(t=this.currentPackage())==null?void 0:t.animations.shift();return((s=this.currentPackage())==null?void 0:s.animations.length)===0&&this.queue.shift(),e}popAnimation(){var t,s;const e=(t=this.currentPackage())==null?void 0:t.animations.pop();return((s=this.currentPackage())==null?void 0:s.animations.length)===0&&this.queue.pop(),e}enqueue(e,t=1,s=b){return this.currentPackage()===void 0?(this.push(e,s),this):t===0?(this.clear(),this.push(e,s),this):t<=this.queue.length?(this.queue[t]=this.verifyAnimations(e,s),this):(this.push(e,s),this)}clear(){return this.queue=[],this.index=0,this.step=0,this}get animations(){return[...this.queue]}}class ${constructor(){this._children=[],this._parent=void 0,this._region=new Path2D,this.events=void 0,this.name="",this.details=void 0,this.channelCount=1,this.channels=[]}addChild(e){return e._parent=this,this._children.push(e),this}addChildren(...e){return e.forEach(t=>t._parent=this),this._children.push(...e),this}removeChild(e){return e._parent=void 0,this._children=this._children.filter(t=>t!==e),this}removeChildren(...e){return e.forEach(t=>t._parent=void 0),this._children=this._children.filter(t=>!e.includes(t)),this}}class O extends ${get effects(){return this.properties.effects}set effects(e){this.properties.effects=e}get blur(){return this.properties.blur}set blur(e){this.properties.blur=e}get gradient(){return this.properties.gradient}set gradient(e){this.properties.gradient=e}get bounds(){return w(this.x1,this.y1,this.x2,this.y2)}set bounds(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}get red(){return this.properties.red}set red(e){this.properties.red=e}get green(){return this.properties.green}set green(e){this.properties.green=e}get blue(){return this.properties.blue}set blue(e){this.properties.blue=e}get colorAlpha(){return this.properties.colorAlpha}set colorAlpha(e){this.properties.colorAlpha=e}get color(){return i(this.red,this.green,this.blue,this.colorAlpha)}set color(e){this.red=e.red,this.green=e.green,this.blue=e.blue,this.colorAlpha=e.alpha}get alpha(){return this.properties.alpha}set alpha(e){this.properties.alpha=e}get rotation(){return this.properties.rotation}set rotation(e){this.properties.rotation=e}get scale(){return f(this.scaleX,this.scaleY)}set scale(e){this.properties.scaleX=e.x,this.properties.scaleY=e.y}get x1(){return this.properties.x1}set x1(e){this.properties.x1=e}get y1(){return this.properties.y1}set y1(e){this.properties.y1=e}get x2(){return this.properties.x2}set x2(e){this.properties.x2=e}get y2(){return this.properties.y2}set y2(e){this.properties.y2=e}get scaleX(){return this.properties.scaleX}set scaleX(e){this.properties.scaleX=e}get scaleY(){return this.properties.scaleY}set scaleY(e){this.properties.scaleY=e}get width(){return Math.abs(this.x2-this.x1)}set width(e){const t=this.centerX;this.x1=t-e/2,this.x2=t+e/2}get height(){return Math.abs(this.y2-this.y1)}set height(e){const t=this.centerY;this.y1=t-e/2,this.y2=t+e/2}get centerX(){return(this.x1+this.x2)/2}set centerX(e){const t=this.width;this.x1=e-t/2,this.x2=e+t/2}get centerY(){return(this.y1+this.y2)/2}set centerY(e){const t=this.height;this.y1=e-t/2,this.y2=e+t/2}get center(){return f(this.centerX,this.centerY)}set center(e){this.centerX=e.x,this.centerY=e.y}get corner1(){return f(this.x1,this.y1)}set corner1(e){this.x1=e.x,this.y1=e.y}get corner2(){return f(this.x2,this.y2)}set corner2(e){this.x2=e.x,this.y2=e.y}addEventListener(e,t){return this.eventListeners[e].push(t),this}on(e,t){return this.addEventListener(e,t)}removeEventListener(e,t){return t?this.eventListeners[e]=this.eventListeners[e].filter(s=>s!==t):this.eventListeners[e]=[],this}constructor(e,t){var s,a,n,r,o,l,d,c,u,p;super(),this.drawFunction=()=>{},this.rootPointerEventCallback=()=>{},this._region=new Path2D,this.enabled=!0,this.pointerId=void 0,this.pointerButton=void 0,this.hovered=!1,this.eventListeners={click:[],drag:[],hover:[],hoverEnd:[],release:[],scroll:[],beforeDraw:[],animationFinish:[]},this.events={stage:void 0},this.name=t.name??"",this.enabled=t.enabled??!0,this.properties={...e,alpha:t.alpha??1,rotation:t.rotation??0,scaleX:((s=t.scale)==null?void 0:s.x)??1,scaleY:((a=t.scale)==null?void 0:a.y)??1,red:((n=t.color)==null?void 0:n.red)??0,green:((r=t.color)==null?void 0:r.green)??0,blue:((o=t.color)==null?void 0:o.blue)??0,colorAlpha:((l=t.color)==null?void 0:l.alpha)??1,effects:t.effects??(()=>{}),gradient:t.gradient??null,blur:t.blur??0,name:t.name??"",x1:((d=t.bounds)==null?void 0:d.x1)??0,y1:((c=t.bounds)==null?void 0:c.y1)??0,x2:((u=t.bounds)==null?void 0:u.x2)??0,y2:((p=t.bounds)==null?void 0:p.y2)??0,channelCount:t.channelCount??1},this.channels=Array.from({length:this.properties.channelCount},()=>new W),this.details=t.details}draw(e,t,s){if(!this.enabled)return;if(s=s??!0,s&&(this.rootPointerEventCallback=()=>{}),this.animate(),e.save(),this.effects(e),e.globalAlpha=this.alpha,e.translate(Math.min(this.x1,this.x2)+this.width/2,Math.min(this.y1,this.y2)+this.height/2),e.fillStyle=this.gradient?this.gradient:Y({red:this.red,green:this.green,blue:this.blue,alpha:this.colorAlpha}),this.rotation!==0&&e.rotate(this.rotation*Math.PI/180),(this.scaleX!==1||this.scaleY!==1)&&e.scale(this.scaleX,this.scaleY),this.blur!==0&&(e.filter=`blur(${this.blur}px)`),this.events.stage){const n=this.events.stage;this.eventListeners.beforeDraw.forEach(r=>{r.call(this,n.currentFrame)})}const a=this.drawFunction(e,t);a!==void 0&&(this._region=a),this._children.forEach(n=>{n.events=this.events,n.draw(e,void 0,!1)}),this.handlePointerEvents(e)||e.restore(),s&&this.rootPointerEventCallback()}handlePointerEvents(e){let t=!1;if(this.events===void 0||!this.events.down&&!this.events.up&&!this.events.move||[this.eventListeners.click,this.eventListeners.drag,this.eventListeners.hover,this.eventListeners.hoverEnd,this.eventListeners.release].every(n=>n.length===0))return!1;const s=[this.events.down,this.events.up,this.events.move].every(n=>n===void 0||this.pointIsInPath(e,n.translatedPoint.x,n.translatedPoint.y));if(this.eventListeners.hover.length>0&&!this.hovered&&s)this.eventListeners.hover.forEach(n=>{var r,o,l,d;return n.call(this,((r=this.events.move)==null?void 0:r.event)??((o=this.events.down)==null?void 0:o.event)??this.events.up.event,((l=this.events.move)==null?void 0:l.translatedPoint)??((d=this.events.down)==null?void 0:d.translatedPoint)??this.events.up.translatedPoint)}),this.hovered=!0;else if(!s&&this.hovered){if(this.eventListeners.hoverEnd.length>0){const n=[this.events.down,this.events.up,this.events.move].find(r=>r!==void 0&&!this.pointIsInPath(e,r.translatedPoint.x,r.translatedPoint.y));this.eventListeners.hoverEnd.forEach(r=>{r.call(this,n.event,n.translatedPoint)})}this.hovered=!1}const a=(n,r,o,l,d)=>{const{event:c,translatedPoint:u}=r,p=n.getTransform().inverse().transformPoint(u),v=n.getTransform(),g=()=>{n.save(),n.setTransform(v.a,v.b,v.c,v.d,v.e,v.f),d.forEach(m=>m.call(l,c,p)),n.restore()};o.rootPointerEventCallback=g.bind(this)};if(this.events.move&&!this.events.up&&!this.events.down&&this.pointerId!==void 0&&this.eventListeners.drag.length>0&&(e.restore(),t=!0,a(e,this.events.move,this.root,this,this.eventListeners.drag)),this.events.up){if(e.restore(),t=!0,this.eventListeners.release.length>0&&this.pointerId!==void 0){const n=this.events.up;a(e,n,this.root,this,this.eventListeners.release)}this.pointerId=void 0}else if(this.events.down&&s){e.restore(),t=!0;const n=this.events.down;this.pointerId=n.event.pointerId,this.pointerButton=n.event.button,this.eventListeners.click.length>0&&a(e,n,this.root,this,this.eventListeners.click)}return t}pointIsInPath(e,t,s){return e.isPointInPath(this._region,t,s)}static initializeProps(e){return{color:e.color??i(0,0,0),alpha:e.alpha??1,rotation:e.rotation??0,scale:e.scale??f(1,1),bounds:e.bounds??w(0,0,0,0),name:e.name??"",effects:e.effects??(()=>{})}}get children(){return[...this._children]}get parent(){return this._parent}get root(){return this._parent===void 0?this:this._parent.root}logHierarchy(e=0){const t=this.name===""?this.constructor.name:this.name,s=[this.red,this.green,this.blue].every(r=>r<25)?125:this.red,a=[this.red,this.green,this.blue].every(r=>r<25)?125:this.green,n=[this.red,this.green,this.blue].every(r=>r<25)?125:this.blue;console.log(`%c${"	".repeat(e)} ⌞${t} 	{ ${this.constructor.name} @ (${this.x1}, ${this.y1}) (${this.x2}, ${this.y2}) }`,`color: ${Y(i(s,a,n))}; font-weight: bold;`),this._children.forEach(r=>r.logHierarchy(e+1))}distribute(e,t={loop:!1,iterations:1,delay:0}){if(e.length>this.channels.length)throw new Error(`Cannot distribute ${e.length} animations to ${this.channels.length} channels`);for(let s=0;s<e.length;s++){const a=e[s];this.channels[s%this.channels.length].push(a,t)}return this}set(e,t){return this[e]=t,!0}animate(){const e=this.channels.map(t=>t.stepForward()).filter(t=>t!==null);for(const t of e.reverse())this.animateProperty(t);return this}animateProperty(e){if((e._from===void 0||e.frame===0)&&(e.from===null?e._from=this[e.property]:e._from=e.from),e._to===void 0||e.frame===0)if(typeof e.to=="function"){const o=e.to;e._to=o(e._from)}else e._to=e.to;const[t,s,a,n,r]=[e._from,e._to,e.frame??0,e.duration,e.easing];if(typeof this[e.property]=="number"&&typeof t=="number"&&typeof s=="number")this.set(e.property,t+r(a/n)*(s-t));else if(typeof this[e.property]=="object"){(typeof t!="object"||typeof s!="object")&&this.raiseAnimationError(t,s,e.property);const o={...s};for(const l of Object.keys(s)){const d=t[l],c=s[l];(d===void 0||c===void 0)&&this.raiseAnimationError(t,s,l),o[l]=d+r(a/n)*(c-d)}this.set(e.property,o)}else throw new Error(`Property ${e.property} is not a valid property`);e.frame===e.duration&&this.eventListeners.animationFinish.forEach(o=>o.call(this,e))}raiseAnimationError(e,t,s){throw new Error(`${e} -> ${t} is not a valid animation for property ${s}`)}setPointerEvents(e){return this.events=e,this}r_setPointerEvents(e){return this.setPointerEvents(e),this._children.forEach(t=>t.r_setPointerEvents(e)),this}createChannels(e){return this.channels.push(...Array.from({length:e},()=>new W)),this}findChild(e){return this._children.find(t=>t.name===e)}findChildren(e){return this._children.filter(t=>t.name===e)}r_findChild(e){return this._children.find(t=>t.name===e)??this._children.map(t=>t.r_findChild(e)).find(t=>t!==void 0)}r_findChildren(e){return this._children.filter(t=>t.name===e)??this._children.map(t=>t.r_findChildren(e)).flat()}r_getChildren(){const e=[...this._children];return this._children.forEach(t=>e.push(...t.r_getChildren())),e}addChild(e){return super.addChild(e),this}addChildren(...e){return super.addChildren(...e),this}removeChild(e){return super.removeChild(e),this}removeChildren(...e){return super.removeChildren(...e),this}hasEventListeners(){return Object.values(this.eventListeners).some(e=>e.length>0)}spriteOrChildrenHaveEventListeners(){return this.hasEventListeners()?!0:this._children.some(e=>e.spriteOrChildrenHaveEventListeners())}copy(){const e=new this.constructor({...this});for(let t of Object.values(this.eventListeners))t=t.map(s=>s.bind(e));return e.properties={...structuredClone({...this.properties,effects:null}),effects:this.properties.effects.bind(e)},e.properties.effects=this.properties.effects.bind(e),e._children=this._children.map(t=>t.copy()),e}}class q extends O{constructor(e){var t,s,a,n,r,o;e.position=e.position??f(0,0),e.bounds=w(((t=e.position)==null?void 0:t.x)??0,((s=e.position)==null?void 0:s.y)??0,((a=e.position)==null?void 0:a.x)??0,((n=e.position)==null?void 0:n.y)??0),e.color={red:0,green:0,blue:0,alpha:0},super({positionX:((r=e.position)==null?void 0:r.x)??0,positionY:((o=e.position)==null?void 0:o.y)??0},e)}get position(){return f(this.properties.positionX,this.properties.positionY)}set position(e){this.properties.positionX=e.x,this.properties.positionY=e.y,this.center=e}get positionX(){return this.properties.positionX}set positionX(e){this.properties.positionX=e}get positionY(){return this.properties.positionY}set positionY(e){this.properties.positionY=e}pointIsInPath(){return!1}}class D extends O{constructor(e,t){var s,a,n,r,o,l,d,c,u,p,v,g,m,R,B;super({...e,strokeRed:((a=(s=t.stroke)==null?void 0:s.color)==null?void 0:a.red)??0,strokeGreen:((r=(n=t.stroke)==null?void 0:n.color)==null?void 0:r.green)??0,strokeBlue:((l=(o=t.stroke)==null?void 0:o.color)==null?void 0:l.blue)??0,strokeAlpha:((c=(d=t.stroke)==null?void 0:d.color)==null?void 0:c.alpha)??1,strokeWidth:((u=t.stroke)==null?void 0:u.lineWidth)??1,strokeJoin:((p=t.stroke)==null?void 0:p.lineJoin)??"miter",strokeCap:((v=t.stroke)==null?void 0:v.lineCap)??"butt",strokeDash:((g=t.stroke)==null?void 0:g.lineDash)??0,strokeDashGap:((m=t.stroke)==null?void 0:m.lineDashGap)??((R=t.stroke)==null?void 0:R.lineDash)??0,strokeOffset:((B=t.stroke)==null?void 0:B.lineDashOffset)??0,strokeEnabled:t.stroke!==null&&t.stroke!==void 0},t)}get stroke(){return this.strokeEnabled?{color:{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha},lineWidth:this.strokeWidth,lineJoin:this.strokeJoin,lineCap:this.strokeCap,lineDash:this.strokeDash,lineDashGap:this.strokeDashGap,lineDashOffset:this.strokeOffset}:null}set stroke(e){var t,s,a,n;this.strokeEnabled=e!==null,e!==null&&(this.strokeRed=((t=e.color)==null?void 0:t.red)??0,this.strokeGreen=((s=e.color)==null?void 0:s.green)??0,this.strokeBlue=((a=e.color)==null?void 0:a.blue)??0,this.strokeAlpha=((n=e.color)==null?void 0:n.alpha)??1,this.strokeWidth=e.lineWidth??1,this.strokeJoin=e.lineJoin??"miter",this.strokeCap=e.lineCap??"butt",this.strokeDash=e.lineDash??0,this.strokeDashGap=e.lineDashGap??e.lineDash??0,this.strokeOffset=e.lineDashOffset??0)}get strokeEnabled(){return this.properties.strokeEnabled}set strokeEnabled(e){this.properties.strokeEnabled=e}get strokeRed(){return this.properties.strokeRed}set strokeRed(e){this.properties.strokeRed=e}get strokeGreen(){return this.properties.strokeGreen}set strokeGreen(e){this.properties.strokeGreen=e}get strokeBlue(){return this.properties.strokeBlue}set strokeBlue(e){this.properties.strokeBlue=e}get strokeAlpha(){return this.properties.strokeAlpha}set strokeAlpha(e){this.properties.strokeAlpha=e}get strokeWidth(){return this.properties.strokeWidth}set strokeWidth(e){this.properties.strokeWidth=e}get strokeJoin(){return this.properties.strokeJoin}set strokeJoin(e){this.properties.strokeJoin=e}get strokeCap(){return this.properties.strokeCap}set strokeCap(e){this.properties.strokeCap=e}get strokeDash(){return this.properties.strokeDash}set strokeDash(e){this.properties.strokeDash=e}get strokeDashGap(){return this.properties.strokeDashGap}set strokeDashGap(e){this.properties.strokeDashGap=e}get strokeOffset(){return this.properties.strokeOffset}set strokeOffset(e){this.properties.strokeOffset=e}get strokeColor(){return{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha}}set strokeColor(e){this.strokeRed=e.red,this.strokeGreen=e.green,this.strokeBlue=e.blue,this.strokeAlpha=e.alpha}draw(e,t){super.draw(e,{...t,stroke:this.strokeEnabled?{color:{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha},lineWidth:this.strokeWidth,lineJoin:this.strokeJoin,lineCap:this.strokeCap,lineDash:this.strokeDash,lineDashGap:this.strokeDashGap,lineDashOffset:this.strokeOffset}:null})}}class G extends D{constructor(e){super({radius:e.radius??[0]},e),this.drawFunction=G.drawFunction}get radius(){return this.properties.radius}set radius(e){this.properties.radius=e}draw(e){super.draw(e,{bounds:this.bounds,radius:this.radius})}static Bounds(e,t,s,a){return T(e,t,s,a)}}G.drawFunction=(h,e)=>{var c;const t=F(e.bounds??w(0,0,0,0));if(e.stroke===null||((c=e.stroke)==null?void 0:c.lineWidth)===0)if(e.radius&&e.radius[0]===0&&e.radius.length===1){const u=new Path2D;return u.rect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),h.fill(u,"nonzero"),u}else{const u=new Path2D;return u.roundRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,e.radius),h.fill(u,"nonzero"),u}const{color:s,lineWidth:a,lineJoin:n,lineCap:r,lineDash:o,lineDashGap:l,lineDashOffset:d}=e.stroke;if(h.lineWidth=a??1,h.lineJoin=n??"miter",h.lineCap=r??"round",h.strokeStyle=`rgba(${(s==null?void 0:s.red)??0}, ${(s==null?void 0:s.green)??0}, ${(s==null?void 0:s.blue)??0}, ${(s==null?void 0:s.alpha)??1})`,h.setLineDash([o??0,l??0]),h.lineDashOffset=d??0,o===0){const u=new Path2D;return u.roundRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,e.radius),h.fill(u,"nonzero"),h.stroke(u),u}else{const u=new Path2D;return u.roundRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,e.radius),h.fill(u,"nonzero"),h.stroke(u),u}};class H extends D{constructor(e){var a,n;super({startAngle:e.startAngle??0,endAngle:e.endAngle??360},e),this.drawFunction=(r,o)=>{var v;const[l,d]=typeof o.radius=="number"?[o.radius,o.radius]:o.radius??[5,5],c=X(o.center.x,o.center.y,l,d),u=_(c);r.beginPath();const p=new Path2D;if(p.ellipse(0,0,u[2]/2,u[3]/2,0,(o.startAngle??0)*Math.PI/180,(o.endAngle??0)*Math.PI/180),p.closePath(),r.fill(p,"nonzero"),r.closePath(),o.stroke!==null&&((v=o.stroke)==null?void 0:v.lineWidth)!==0){const{color:g,lineWidth:m,lineJoin:R,lineCap:B,lineDash:N,lineDashGap:V,lineDashOffset:U}=o.stroke;r.lineWidth=m??1,r.lineJoin=R??"miter",r.lineCap=B??"round",r.strokeStyle=`rgba(${(g==null?void 0:g.red)??0}, ${(g==null?void 0:g.green)??0}, ${(g==null?void 0:g.blue)??0}, ${(g==null?void 0:g.alpha)??1})`,r.setLineDash([N??0,V??0]),r.lineDashOffset=U??0,r.stroke(p)}return p};const t=typeof e.radius=="number"?[e.radius,e.radius]:e.radius??[5,5],s=X(((a=e.center)==null?void 0:a.x)??0,((n=e.center)==null?void 0:n.y)??0,t[0],t[1]);this.x1=s.x1,this.y1=s.y1,this.x2=s.x2,this.y2=s.y2}get startAngle(){return this.properties.startAngle}set startAngle(e){this.properties.startAngle=e}get endAngle(){return this.properties.endAngle}set endAngle(e){this.properties.endAngle=e}get radiusX(){return this.width/2}set radiusX(e){this.width=e*2}get radiusY(){return this.height/2}set radiusY(e){this.height=e*2}get radius(){return[this.radiusX,this.radiusY]}set radius(e){typeof e=="number"?(this.radiusX=e,this.radiusY=e):(this.radiusX=e[0],this.radiusY=e[1])}get center(){return{x:this.centerX,y:this.centerY}}set center(e){this.centerX=e.x,this.centerY=e.y}get bounds(){return X(this.centerX,this.centerY,this.radiusX,this.radiusY)}set bounds(e){const[t,s,a,n]=_(e);this.centerX=(t+a)/2,this.centerY=(s+n)/2,this.radiusX=(a-t)/2,this.radiusY=(n-s)/2}draw(e){super.draw(e,{center:{x:this.centerX,y:this.centerY},radius:[this.radiusX,this.radiusY],startAngle:this.startAngle,endAngle:this.endAngle})}}class y extends D{constructor(e){super({path:e.path??[],closePath:e.closePath??!1,fillRule:e.fillRule??"nonzero",startRatio:e.startRatio??0,endRatio:e.endRatio??1},e),this.drawFunction=y.drawFunction;const t=y.getBoundsFromPath(this.path);this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2}get path(){return this.properties.path}set path(e){this.properties.path=e}get closePath(){return this.properties.closePath}set closePath(e){this.properties.closePath=e}get fillRule(){return this.properties.fillRule}set fillRule(e){this.properties.fillRule=e}get startRatio(){return this.properties.startRatio}set startRatio(e){this.properties.startRatio=e}get endRatio(){return this.properties.endRatio}set endRatio(e){this.properties.endRatio=e}draw(e){const t=y.getBoundsFromPath(this.path);this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,super.draw(e,{path:this.path,fillRule:this.fillRule,closePath:this.closePath,startRatio:this.startRatio,endRatio:this.endRatio})}get bounds(){return y.getBoundsFromPath(this.path)}set bounds(e){throw new Error("Path bounds cannot be set")}static getPathSegment(e,t,s){if(t===0&&s===1)return e;if(t===s)return[];if(t>s)return y.getPathSegment(e,s,t).reverse();if(t<0||s>1)throw new Error("Start and end must be between 0 and 1");const a=e.map((d,c)=>y.calculateDistance(d,e[c+1]??e[0]));a.pop();const n=a.reduce((d,c)=>d+c,0),r=[];let o=0,l=0;for(const d of a){const c=d/n;if(l+c<t){l+=c,o++;continue}let u=0;l+c>t&&l<t&&(u=(t-l)*(1/c));let p=1;if(l+c>s&&l<s&&(p=(s-l)*(1/c)),l+c>t&&r.push(y.interpolate(e[o],e[o+1]??e[0],u)),l<s&&l+c>s)return r.push(y.interpolate(e[o],e[o+1]??e[0],p)),r;l+=c,o++}return s===1?r.concat(e[e.length-1]):r}static interpolate(e,t,s){return f(e.x+s*(t.x-e.x),e.y+s*(t.y-e.y))}static calculateDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static getBoundsFromPath(e){return w(Math.min(...e.map(t=>t.x)),Math.min(...e.map(t=>t.y)),Math.max(...e.map(t=>t.x)),Math.max(...e.map(t=>t.y)))}}y.drawFunction=(h,e)=>{var a,n;let t=((a=e.path)==null?void 0:a.map(r=>x(y.getBoundsFromPath(e.path??[]),r)))??[];if(t=y.getPathSegment(t,e.startRatio??0,e.endRatio??1),t.length===0)return new Path2D;const s=new Path2D;s.moveTo(t[0].x,t[0].y);for(const r of t.slice(1))s.lineTo(r.x,r.y);if(e.closePath&&s.closePath(),h.fill(s,e.fillRule??"nonzero"),e.stroke!==null&&((n=e.stroke)==null?void 0:n.lineWidth)!==0){const{color:r,lineWidth:o,lineJoin:l,lineCap:d,lineDash:c,lineDashGap:u,lineDashOffset:p}=e.stroke;h.lineWidth=o??1,h.lineJoin=l??"miter",h.lineCap=d??"round",h.strokeStyle=`rgba(${(r==null?void 0:r.red)??0}, ${(r==null?void 0:r.green)??0}, ${(r==null?void 0:r.blue)??0}, ${(r==null?void 0:r.alpha)??1})`,h.setLineDash([c??0,u??0]),h.lineDashOffset=p??0,h.stroke(s)}return s};class C extends D{constructor(e){var t,s;super({text:e.text??"",positionX:((t=e.position)==null?void 0:t.x)??0,positionY:((s=e.position)==null?void 0:s.y)??0,positionIsCenter:e.positionIsCenter??!1,font:e.font??"sans-serif",fontSize:e.fontSize??16,textAlign:e.textAlign??"start",textBaseline:e.textBaseline??"alphabetic",textDirection:e.textDirection??"inherit",maxWidth:e.maxWidth??null,bold:e.bold??!1,italic:e.italic??!1},e),this.drawFunction=C.drawFunction}get text(){return this.properties.text}set text(e){this.properties.text=e}get positionX(){return this.properties.positionX}set positionX(e){this.properties.positionX=e}get positionY(){return this.properties.positionY}set positionY(e){this.properties.positionY=e}get position(){return f(this.positionX,this.positionY)}set position(e){this.positionX=e.x,this.positionY=e.y}get positionIsCenter(){return this.properties.positionIsCenter}set positionIsCenter(e){this.properties.positionIsCenter=e}get font(){return this.properties.font}set font(e){this.properties.font=e}get fontSize(){return this.properties.fontSize}set fontSize(e){this.properties.fontSize=e}get textAlign(){return this.properties.textAlign}set textAlign(e){this.properties.textAlign=e}get textBaseline(){return this.properties.textBaseline}set textBaseline(e){this.properties.textBaseline=e}get textDirection(){return this.properties.textDirection}set textDirection(e){this.properties.textDirection=e}get maxWidth(){return this.properties.maxWidth}set maxWidth(e){this.properties.maxWidth=e}get bold(){return this.properties.bold}set bold(e){this.properties.bold=e}get italic(){return this.properties.italic}set italic(e){this.properties.italic=e}get bounds(){return w(this.x1,this.y1,this.x2,this.y2)}set bounds(e){const{x1:t,y1:s,x2:a,y2:n}=e;this.x1=t,this.y1=s,this.x2=a,this.y2=n}draw(e){var r,o;((r=this.root.stage)==null?void 0:r.rootStyle)==="centered"&&(this.scaleY*=-1),e.font=`${this.bold?"bold ":""}${this.italic?"italic ":""}${this.fontSize}px ${this.font}`,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.direction=this.textDirection;const t=e.measureText(this.text),s=t.width,a=t.actualBoundingBoxAscent,n=this.fontSize;this.positionIsCenter?(this.x1=this.positionX-s/2,this.y1=this.positionY-n/2+(this.fontSize-a),this.x2=this.positionX+s/2,this.y2=this.positionY+n/2):(this.x1=this.positionX,this.y1=this.positionY,this.x2=this.positionX+s,this.y2=this.positionY+n),super.draw(e,{text:this.text,position:f(this.positionX,this.positionY),font:this.font,fontSize:this.fontSize,textAlign:this.textAlign,textBaseline:this.textBaseline,textDirection:this.textDirection,maxWidth:this.maxWidth,bold:this.bold,italic:this.italic,positionIsCenter:this.positionIsCenter}),((o=this.root.stage)==null?void 0:o.rootStyle)==="centered"&&(this.scaleY*=-1)}}C.drawFunction=(h,e)=>{var l;const{text:t,maxWidth:s}=e,a=h.measureText(t??""),n=a.width,r=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent;if(h.fillText(t??"",-n/2,r/2,s??void 0),e.stroke!==null&&((l=e.stroke)==null?void 0:l.lineWidth)!==0){const{color:d,lineWidth:c,lineJoin:u,lineCap:p,lineDash:v,lineDashGap:g,lineDashOffset:m}=e.stroke;h.lineWidth=c??1,h.lineJoin=u??"miter",h.lineCap=p??"round",h.strokeStyle=`rgba(${(d==null?void 0:d.red)??0}, ${(d==null?void 0:d.green)??0}, ${(d==null?void 0:d.blue)??0}, ${(d==null?void 0:d.alpha)??1})`,h.setLineDash([v??0,g??0]),h.lineDashOffset=m??0,h.strokeText(t??"",-n/2,r/2,s??void 0)}const o=new Path2D;return o.moveTo(-n/2,-r/2),o.lineTo(n/2,-r/2),o.lineTo(n/2,r/2),o.lineTo(-n/2,r/2),o.closePath(),o};class I extends q{constructor(e,t){super(t),this.stage=e}}class J{constructor(e,t="centered",s=k.White,a,n=!1){if(this.canvas=e,this.rootStyle=t,this.bgColor=s,this.active=!1,this.nextRenderTime=void 0,this.frameRate=60,this.lastRenderMs=0,this.currentFrame=0,this.drawEvents={},this.onError=r=>{console.error(r)},this.eventListeners={beforeDraw:[],click:[],release:[],move:[],scroll:[]},!e)throw new Error("No canvas element provided");this._root=t==="classic"?new I(this,{}):new I(this,{position:f(this.width/2,this.height/2),scale:f(1,-1)}),e.oncontextmenu=()=>!1,e.style.touchAction="none",this.ctx=a??(n?void 0:e.getContext("2d"))}get root(){return this._root}addEventListener(e,t){this.eventListeners[e].push(t)}on(e,t){this.addEventListener(e,t)}removeEventListener(e,t){this.eventListeners[e]=this.eventListeners[e].filter(s=>s!==t)}pointerDownHandler(e){if(!this.active)return;e.preventDefault();const t=f((e.offsetX||e.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((e.offsetY||e.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));this.eventListeners.click.forEach(s=>s.call(this,e,t)),this.drawEvents.down={event:e,translatedPoint:this.positionOnCanvas(this.canvas,e)}}pointerUpHandler(e){if(!this.active)return;e.preventDefault();const t=f((e.offsetX||e.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((e.offsetY||e.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));this.eventListeners.release.forEach(s=>s.call(this,e,t)),this.drawEvents.up={event:e,translatedPoint:this.positionOnCanvas(this.canvas,e)}}pointerMoveHandler(e){if(!this.active)return;e.preventDefault();const t=f((e.offsetX||e.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((e.offsetY||e.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));this.eventListeners.move.forEach(s=>s.call(this,e,t)),this.drawEvents.move={event:e,translatedPoint:this.positionOnCanvas(this.canvas,e)}}wheelHandler(e){this.active&&(this.eventListeners.scroll.forEach(t=>t.call(this,e)),e.preventDefault())}positionOnCanvas(e,t){return f((t.offsetX||t.clientX-e.getBoundingClientRect().left)*e.width/e.clientWidth,(t.offsetY||t.clientY-e.getBoundingClientRect().top)*e.height/e.clientHeight)}loop(e=60){this.stop(),this.canvas.addEventListener("pointerdown",this.pointerDownHandler.bind(this)),this.canvas.addEventListener("pointerup",this.pointerUpHandler.bind(this)),this.canvas.addEventListener("pointermove",this.pointerMoveHandler.bind(this)),this.canvas.addEventListener("wheel",this.wheelHandler.bind(this)),this.active=!0,this.frameRate=e,this.nextRenderTime=performance.now(),this.currentFrame=0,requestAnimationFrame(this.drawLoop.bind(this))}drawLoop(){const e=performance.now();if(this.nextRenderTime&&e<this.nextRenderTime){requestAnimationFrame(this.drawLoop.bind(this));return}this.nextRenderTime=e+800/this.frameRate,this.active&&(this.draw(this.ctx),this.lastRenderMs=performance.now()-e,requestAnimationFrame(this.drawLoop.bind(this)))}draw(e){e??(e=this.ctx),this.eventListeners.beforeDraw.forEach(t=>t.call(this,this.currentFrame)),this.root.setPointerEvents(this.drawEvents),e.fillStyle=Y(this.bgColor),e.fillRect(0,0,this.width??0,this.height??0),this.drawEvents.stage=this;try{this.root.draw(e)}catch(t){this.stop(),this.onError(t)}this.drawEvents={stage:this},this.currentFrame++}stop(){this.canvas.removeEventListener("pointerdown",this.pointerDownHandler.bind(this)),this.canvas.removeEventListener("pointerup",this.pointerUpHandler.bind(this)),this.canvas.removeEventListener("pointermove",this.pointerMoveHandler.bind(this)),this.canvas.removeEventListener("wheel",this.wheelHandler.bind(this)),this.active=!1}get width(){var e;return(e=this.canvas)==null?void 0:e.width}get height(){var e;return(e=this.canvas)==null?void 0:e.height}get scaleX(){return(this.width??0)/this.canvas.clientWidth}get scaleY(){return(this.height??0)/this.canvas.clientHeight}}const z={width:0,height:0,oncontextmenu:()=>!1,style:{touchAction:"none"},getContext:()=>null,offsetLeft:0,offsetTop:0,addEventListener:()=>{},clientWidth:0,clientHeight:0,getBoundingClientRect:()=>({top:0,left:0}),removeEventListener:()=>{},transferToImageBitmap:()=>{}};class j extends J{constructor(e,t="centered",s=k.White){const a=new OffscreenCanvas(1,1);super(z,t,s,a.getContext("2d")),this._postMessage=e,this.rootStyle=t,this.bgColor=s,this.eventListeners={beforeDraw:[],click:[],release:[],move:[],scroll:[],message:[]},this.onError=function(n){this.postMessage({type:"error",error:(n==null?void 0:n.message)??"Error"})},this.informOffscreenOfStop=!0,this.onmessage=n=>{this.eventListeners.message.forEach(o=>o.call(this,n.data));const r=n.data;switch(r.type){case"init":this.canvas.height=r.height,this.canvas.offsetLeft=0,this.canvas.offsetTop=0,this.offscreenCanvas.width=r.width,this.offscreenCanvas.height=r.height,this._root.position=this.rootStyle==="centered"?f(r.width/2,r.height/2):f(0,0),this.postMessage({type:"ready"}),this.loop();break;case"beginLoop":this.setStageState({...r.stageState,type:"stageState"}),this.loop(r.frameRate*1.25);break;case"stageState":this.setStageState(r);break;case"stopLoop":this.stop();break}},this.offscreenCanvas=a}addEventListener(e,t){this.eventListeners[e].push(t)}on(e,t){this.addEventListener(e,t)}removeEventListener(e,t){this.eventListeners[e]=this.eventListeners[e].filter(s=>s!==t)}setStageState(e){var t,s,a;this.nextDrawEvents??(this.nextDrawEvents={}),(t=this.nextDrawEvents).up??(t.up=e.events.up),(s=this.nextDrawEvents).down??(s.down=e.events.down),(a=this.nextDrawEvents).move??(a.move=e.events.move),this.canvas.width=e.canvasProperties.width,this.canvas.height=e.canvasProperties.height,this.canvas.offsetLeft=e.canvasProperties.offsetLeft,this.canvas.offsetTop=e.canvasProperties.offsetTop,this.canvas.clientWidth=e.canvasProperties.clientWidth,this.canvas.clientHeight=e.canvasProperties.clientHeight,this.canvas.getBoundingClientRect=()=>e.canvasProperties.boundingClientRect}draw(e){this.drawEvents=this.nextDrawEvents?JSON.parse(JSON.stringify(this.nextDrawEvents)):this.drawEvents,this.eventListeners.beforeDraw.forEach(n=>n.call(this,this.currentFrame));const{down:t,up:s,move:a}=this.drawEvents;t&&this.eventListeners.click.forEach(n=>n.call(this,t.event,t.translatedPoint)),s&&this.eventListeners.release.forEach(n=>n.call(this,s.event,s.translatedPoint)),a&&this.eventListeners.move.forEach(n=>n.call(this,a.event,a.translatedPoint)),this.eventListeners.beforeDraw.forEach(n=>n.call(this,this.currentFrame)),super.draw(e),this.postMessage({type:"render",img:this.offscreenCanvas.transferToImageBitmap(),lastRenderMs:this.lastRenderMs,currentFrame:this.currentFrame}),this.nextDrawEvents=void 0}postCustomMessage(e,t){this.postMessage({type:"custom",message:e},t)}postMessage(e,t){if(!t){this._postMessage(e);return}t.postMessage(e)}loop(e=60){this.informOffscreenOfStop=!1,super.loop(e),this.informOffscreenOfStop=!0}stop(){super.stop(),this.informOffscreenOfStop&&this.postMessage({type:"stopLoop",source:"worker"})}}const E=new j(postMessage.bind(null),"centered",k.LightSlateGray);onmessage=E.onmessage;const P=new H({color:k.Red,radius:75,center:{x:-100,y:100},stroke:{lineWidth:5},details:"red"}),L=P.copy();L.color=k.Green,L.center={x:100,y:100},L.details="green";const A=P.copy();A.color=k.Yellow,A.center={x:-100,y:-100},A.details="yellow";const S=P.copy();S.color=k.Aqua,S.center={x:100,y:-100},S.details="blue";const M=new C({text:"Click a circle!",position:{x:0,y:0},positionIsCenter:!0,fontSize:30,bold:!0,color:k.White});[P,L,A,S].forEach(h=>{h.on("click",function(){E.postCustomMessage(this.details),M.text=`You clicked the ${this.details} circle!`,M.color=this.color}),E.root.addChild(h)}),E.root.addChild(M)})();
