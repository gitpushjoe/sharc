(function(){"use strict";function c(a,t){return{x:a,y:t}}function B(a){return`rgba(${a.red}, ${a.green}, ${a.blue}, ${a.alpha})`}function n(a,t,e,s=1){return{red:a,green:t,blue:e,alpha:s}}function S(a,t,e,s){return{x1:a,y1:t,x2:e,y2:s}}function xt(a,t,e,s){return{x1:a,y1:t,x2:a+e,y2:t+s}}function J(a,t,e,s){return{x1:a-e,y1:t-(s??e),x2:a+e,y2:t+(s??e)}}function mt(a){return[-Math.abs(a.x1-a.x2)/2,-Math.abs(a.y1-a.y2)/2,Math.abs(a.x1-a.x2),Math.abs(a.y1-a.y2)]}function k(a,t){return c(t.x-a.x1-(a.x2-a.x1)/2,t.y-a.y1-(a.y2-a.y1)/2)}function N(a){return S(k(a,c(a.x1,a.y1)).x,k(a,c(a.x1,a.y1)).y,k(a,c(a.x2,a.y2)).x,k(a,c(a.x2,a.y2)).y)}function g(a,t,e,s=console.error){const h=[];for(let r=0;r<a[t].length;r++){const o=a[t][r],i=o(...e);if(i!==void 0&&i!=1&&i!=0){const l=(()=>{try{return JSON.stringify(i)}catch{return i.toString()}})();s(`WARNING: Event listener ${t.toString()} returned non-meaningful value ${l}, ignored.
Event listeners should only return true (or 1), false (or 0), or undefined (including implicit return).`)}i==1&&h.push(o)}a[t]=a[t].filter(r=>!h.includes(r))}const b={AliceBlue:n(240,248,255),AntiqueWhite:n(250,235,215),Aqua:n(0,255,255),Aquamarine:n(127,255,212),Azure:n(240,255,255),Beige:n(245,245,220),Bisque:n(255,228,196),Black:n(0,0,0),BlanchedAlmond:n(255,235,205),Blue:n(0,0,255),BlueViolet:n(138,43,226),Brown:n(165,42,42),BurlyWood:n(222,184,135),CadetBlue:n(95,158,160),Chartreuse:n(127,255,0),Chocolate:n(210,105,30),Coral:n(255,127,80),CornflowerBlue:n(100,149,237),Cornsilk:n(255,248,220),Crimson:n(220,20,60),Cyan:n(0,255,255),DarkBlue:n(0,0,139),DarkCyan:n(0,139,139),DarkGoldenRod:n(184,134,11),DarkGray:n(169,169,169),DarkGreen:n(0,100,0),DarkKhaki:n(189,183,107),DarkMagenta:n(139,0,139),DarkOliveGreen:n(85,107,47),Darkorange:n(255,140,0),DarkOrchid:n(153,50,204),DarkRed:n(139,0,0),DarkSalmon:n(233,150,122),DarkSeaGreen:n(143,188,143),DarkSlateBlue:n(72,61,139),DarkSlateGray:n(47,79,79),DarkTurquoise:n(0,206,209),DarkViolet:n(148,0,211),DeepPink:n(255,20,147),DeepSkyBlue:n(0,191,255),DimGray:n(105,105,105),DodgerBlue:n(30,144,255),FireBrick:n(178,34,34),FloralWhite:n(255,250,240),ForestGreen:n(34,139,34),Fuchsia:n(255,0,255),Gainsboro:n(220,220,220),GhostWhite:n(248,248,255),Gold:n(255,215,0),GoldenRod:n(218,165,32),Gray:n(128,128,128),Green:n(0,128,0),GreenYellow:n(173,255,47),HoneyDew:n(240,255,240),HotPink:n(255,105,180),IndianRed:n(205,92,92),Indigo:n(75,0,130),Ivory:n(255,255,240),Khaki:n(240,230,140),Lavender:n(230,230,250),LavenderBlush:n(255,240,245),LawnGreen:n(124,252,0),LemonChiffon:n(255,250,205),LightBlue:n(173,216,230),LightCoral:n(240,128,128),LightCyan:n(224,255,255),LightGoldenRodYellow:n(250,250,210),LightGrey:n(211,211,211),LightGreen:n(144,238,144),LightPink:n(255,182,193),LightSalmon:n(255,160,122),LightSeaGreen:n(32,178,170),LightSkyBlue:n(135,206,250),LightSlateGray:n(119,136,153),LightSteelBlue:n(176,196,222),LightYellow:n(255,255,224),Lime:n(0,255,0),LimeGreen:n(50,205,50),Linen:n(250,240,230),Magenta:n(255,0,255),Maroon:n(128,0,0),MediumAquaMarine:n(102,205,170),MediumBlue:n(0,0,205),MediumOrchid:n(186,85,211),MediumPurple:n(147,112,216),MediumSeaGreen:n(60,179,113),MediumSlateBlue:n(123,104,238),MediumSpringGreen:n(0,250,154),MediumTurquoise:n(72,209,204),MediumVioletRed:n(199,21,133),MidnightBlue:n(25,25,112),MintCream:n(245,255,250),MistyRose:n(255,228,225),Moccasin:n(255,228,181),NavajoWhite:n(255,222,173),Navy:n(0,0,128),OldLace:n(253,245,230),Olive:n(128,128,0),OliveDrab:n(107,142,35),Orange:n(255,165,0),OrangeRed:n(255,69,0),Orchid:n(218,112,214),PaleGoldenRod:n(238,232,170),PaleGreen:n(152,251,152),PaleTurquoise:n(175,238,238),PaleVioletRed:n(216,112,147),PapayaWhip:n(255,239,213),PeachPuff:n(255,218,185),Peru:n(205,133,63),Pink:n(255,192,203),Plum:n(221,160,221),PowderBlue:n(176,224,230),Purple:n(128,0,128),Red:n(255,0,0),RosyBrown:n(188,143,143),RoyalBlue:n(65,105,225),SaddleBrown:n(139,69,19),Salmon:n(250,128,114),SandyBrown:n(244,164,96),SeaGreen:n(46,139,87),SeaShell:n(255,245,238),Sienna:n(160,82,45),Silver:n(192,192,192),SkyBlue:n(135,206,235),SlateBlue:n(106,90,205),SlateGray:n(112,128,144),Snow:n(255,250,250),SpringGreen:n(0,255,127),SteelBlue:n(70,130,180),Tan:n(210,180,140),Teal:n(0,128,128),Thistle:n(216,191,216),Tomato:n(255,99,71),Turquoise:n(64,224,208),Violet:n(238,130,238),Wheat:n(245,222,179),White:n(255,255,255),WhiteSmoke:n(245,245,245),Yellow:n(255,255,0),YellowGreen:n(154,205,50),None:n(0,0,0,0),Transparent:n(0,0,0,0)},T={loop:!1,iterations:1,delay:0};class I{constructor(){this.queue=[],this.index=0,this.step=0}currentPackage(){return this.queue[0]}currentAnimation(){var t;return(t=this.currentPackage())==null?void 0:t.animations[this.index%this.currentPackage().animations.length]}queueIsEmpty(){return this.queue.length===0}stepForward(){return this.queueIsEmpty()?null:(this.step++,this.step>this.currentAnimation().delay+this.currentAnimation().duration+this.currentPackage().params.delay&&(this.step=0,this.index++,this.index>=this.currentPackage().animations.length*this.currentPackage().params.iterations&&(this.index=0,this.currentPackage().params.loop?this.step=0:this.queue.shift()),this.queue.length===0)?(this.index=0,this.step=0,null):this.step<this.currentAnimation().delay+this.currentPackage().params.delay?null:(this.currentAnimation().frame=Math.max(this.step-this.currentAnimation().delay-this.currentPackage().params.delay,0),this.currentAnimation().channel=this.index,this.currentAnimation()))}verifyAnimations(t,e=T){const[s,h,r]=[!!e.loop,e.iterations??1,e.delay??0];if(Array.isArray(t)||(t=[t]),t.length!==0){for(let o=0;o<t.length;o++){const i=t[o];if(i.delay??(i.delay=0),i.duration??(i.duration=60),i.easing??(i.easing=l=>l),i.name??(i.name=""),i.duration<=0)throw new Error("Animation duration must be greater than 0");i.delay<0&&(i.delay=0)}return{animations:t,params:{loop:s,iterations:h,delay:r}}}}push(t,e=T){const s=this.verifyAnimations(t,e);return s&&this.queue.push(s),this}unshift(t,e=T){const s=this.verifyAnimations(t,e);return s&&(this.queue.unshift(s),this.step=0,this.index=0),this}shift(){return this.queue.shift()}pop(){return this.queue.pop()}shiftAnimation(){var e,s;const t=(e=this.currentPackage())==null?void 0:e.animations.shift();return((s=this.currentPackage())==null?void 0:s.animations.length)===0&&this.queue.shift(),t}popAnimation(){var e,s;const t=(e=this.currentPackage())==null?void 0:e.animations.pop();return((s=this.currentPackage())==null?void 0:s.animations.length)===0&&this.queue.pop(),t}enqueue(t,e=1,s=T){return this.currentPackage()===void 0?(this.push(t,s),this):e===0?(this.clear(),this.push(t,s),this):e<=this.queue.length?(this.queue[e]=this.verifyAnimations(t,s),this):(this.push(t,s),this)}clear(){return this.queue=[],this.index=0,this.step=0,this}get animations(){return[...this.queue]}}class St{constructor(){this._children=[],this._parent=void 0,this._region=new Path2D,this.events=void 0,this.currentFrame=0,this.name="",this.details=void 0,this.channelCount=1,this.channels=[]}addChild(t){return this._children.push(t.removeSelf()),t._parent=this,this}addChildren(...t){return t.forEach(e=>this.addChild(e)),this}removeChild(t){const e=this._children.indexOf(t);if(e!==-1)return this._children.splice(e,1),t._parent=void 0,t}removeChildren(...t){const e=[];return t.forEach(s=>{const h=this._children.indexOf(s);h!==-1&&(this._children.splice(h,1),s._parent=void 0,e.push(s))}),e}removeAllChildren(){return this.removeChildren(...this._children)}removeSelf(){var t;return(t=this._parent)==null||t.removeChild(this),this}get children(){return[...this._children]}get descendants(){return this._children.reduce((t,e)=>t.concat(e,e.descendants),[])}get parent(){return this._parent}get root(){return this._parent?this._parent.root:this}findChild(t){return this._children.find(e=>e.name===t)}findDescendant(t){return this._children.find(e=>e.name===t)??this._children.reduce((e,s)=>e??s.findDescendant(t),void 0)}findChildren(t){return this._children.filter(e=>e.name===t)}findDescendants(t){return this._children.reduce((e,s)=>(s.name===t&&e.push(s),e.concat(s.findDescendants(t))),[])}findChildWhere(t){return this._children.find(t)}findDescendantWhere(t){return this._children.find(t)??this._children.reduce((e,s)=>e??s.findDescendantWhere(t),void 0)}findChildrenWhere(t){return this._children.filter(t)}findDescendantsWhere(t){return this._children.reduce((e,s)=>(t(s)&&e.push(s),e.concat(s.findDescendantsWhere(t))),[])}removeChildWhere(t){var e;return(e=this._children.find(t))==null?void 0:e.removeSelf()}removeDescendantWhere(t){const e=this._children.find(t);return e?(this.removeChild(e),e):this._children.reduce((s,h)=>s??h.removeDescendantWhere(t),void 0)}removeChildrenWhere(t){const e=[];return this._children=this._children.filter(s=>t(s)?(e.push(s),!1):!0),e}removeDescendantsWhere(t){const e=[];return this._children=this._children.filter(s=>(e.push(...s.removeDescendantsWhere(t)),t(s)?(e.push(s),!1):!0)),e}bringForward(){if(this._parent){const t=this._parent._children.indexOf(this);if(t==this._parent._children.length-1)return this;this._parent._children.splice(t,1),this._parent._children.splice(t+1,0,this)}return this}sendBackward(){if(this._parent){const t=this._parent._children.indexOf(this);if(t===0)return this;this._parent._children.splice(t,1),this._parent._children.splice(t-1,0,this)}return this}bringToFront(){var t;return(t=this._parent)==null||t.addChild(this),this}sendToBack(){const t=this._parent;return t&&(t._children.unshift(this.removeSelf()),this._parent=t),this}}class q extends St{get bounds(){return S(this.x1,this.y1,this.x2,this.y2)}set bounds(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2}get color(){return n(this.red,this.green,this.blue)}set color(t){this.red=t.red,this.green=t.green,this.blue=t.blue}get scale(){return c(this.scaleX,this.scaleY)}set scale(t){this.scaleX=t.x,this.scaleY=t.y}get corner1(){return c(this.x1,this.y1)}set corner1(t){this.x1=t.x,this.y1=t.y}get corner2(){return c(this.x2,this.y2)}set corner2(t){this.x2=t.x,this.y2=t.y}get width(){return Math.abs(this.x2-this.x1)}set width(t){const e=(this.x1+this.x2)/2;this.x1=e-t/2,this.x2=e+t/2}get height(){return Math.abs(this.y2-this.y1)}set height(t){const e=(this.y1+this.y2)/2;this.y1=e-t/2,this.y2=e+t/2}get centerX(){return(this.x1+this.x2)/2}set centerX(t){const e=this.width;this.x1=t-e/2,this.x2=t+e/2}get centerY(){return(this.y1+this.y2)/2}set centerY(t){const e=this.height;this.y1=t-e/2,this.y2=t+e/2}get center(){return c(this.centerX,this.centerY)}set center(t){this.centerX=t.x,this.centerY=t.y}addEventListener(t,e){return this.eventListeners[t].push(e),this}on(t,e){return this.addEventListener(t,e)}removeEventListener(t,e){return e?(this.eventListeners[t]=this.eventListeners[t].filter(s=>s!==e),this):(this.eventListeners[t]=[],this)}includeEventListener(t,e){return this.removeEventListener(t,e),this.addEventListener(t,e),this}constructor(t){var e,s,h,r,o,i,l,d,f,u;super(),this.drawFunction=()=>{},this.rootPointerEventCallback=()=>{},this._region=new Path2D,this.currentFrame=0,this.rotation=0,this.alpha=1,this.gradient=null,this.effects=()=>{},this.name="",this.enabled=!0,this.channelCount=1,this.details=void 0,this.red=0,this.green=0,this.blue=0,this.colorAlpha=1,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.scaleX=1,this.scaleY=1,this.blur=0,this.pointerId=void 0,this.hovered=!1,this.eventListeners={click:[],drag:[],hover:[],hoverEnd:[],hold:[],release:[],keydown:[],keyup:[],scroll:[],beforeDraw:[],animationFinish:[]},this.events={stage:void 0},this.name=t.name??"",this.enabled=t.enabled??!0,this.rotation=t.rotation??this.rotation,this.alpha=t.alpha??this.alpha,this.gradient=t.gradient??this.gradient,this.effects=t.effects??this.effects,this.red=((e=t.color)==null?void 0:e.red)??this.red,this.green=((s=t.color)==null?void 0:s.green)??this.green,this.blue=((h=t.color)==null?void 0:h.blue)??this.blue,this.colorAlpha=((r=t.color)==null?void 0:r.alpha)??this.colorAlpha,this.x1=((o=t.bounds)==null?void 0:o.x1)??this.x1,this.y1=((i=t.bounds)==null?void 0:i.y1)??this.y1,this.x2=((l=t.bounds)==null?void 0:l.x2)??this.x2,this.y2=((d=t.bounds)==null?void 0:d.y2)??this.y2,this.scaleX=((f=t.scale)==null?void 0:f.x)??this.scaleX,this.scaleY=((u=t.scale)==null?void 0:u.y)??this.scaleY,this.channelCount=t.channelCount??this.channelCount,this.details=t.details,this.channels=Array.from({length:this.channelCount},()=>new I)}draw(t,e,s){if(!this.enabled)return;if(s=s??!0,s&&(this.rootPointerEventCallback=()=>{}),this.currentFrame++,this.animate(),t.save(),this.effects(t),t.globalAlpha=this.alpha,t.translate(Math.min(this.x1,this.x2)+this.width/2,Math.min(this.y1,this.y2)+this.height/2),t.fillStyle=this.gradient?this.gradient:B({red:this.red,green:this.green,blue:this.blue,alpha:this.colorAlpha}),this.rotation!==0&&t.rotate(this.rotation*Math.PI/180),(this.scaleX!==1||this.scaleY!==1)&&t.scale(this.scaleX,this.scaleY),this.blur!==0&&(t.filter=`blur(${this.blur}px)`),this.events.stage){const r=this.events.stage;g(this.eventListeners,"beforeDraw",[this,r.currentFrame,this.events.stage])}const h=this.drawFunction(t,e);h!==void 0&&(this._region=h),this._children.forEach(r=>{r.events=this.events,r.draw(t,void 0,!1)}),this.handlePointerEvents(t)||t.restore(),this.pointerId!==void 0&&g(this.eventListeners,"hold",[this]),s&&this.rootPointerEventCallback()}handlePointerEvents(t){var r,o,i,l,d,f;let e=!1;if(this.events===void 0||!this.events.down&&!this.events.up&&!this.events.move&&!this.events.scroll&&!this.events.keydown&&!this.events.keyup||[this.eventListeners.click,this.eventListeners.drag,this.eventListeners.hold,this.eventListeners.hover,this.eventListeners.hoverEnd,this.eventListeners.keydown,this.eventListeners.keyup,this.eventListeners.release].every(u=>u.length===0))return!1;const s=[this.events.down,this.events.up,this.events.move].every(u=>u===void 0||this.pointIsInPath(t,u.translatedPoint.x,u.translatedPoint.y));if(this.eventListeners.hover.length>0&&!this.hovered&&s)g(this.eventListeners,"hover",[this,((r=this.events.move)==null?void 0:r.translatedPoint)??((o=this.events.down)==null?void 0:o.translatedPoint)??this.events.up.translatedPoint,((i=this.events.move)==null?void 0:i.event)??((l=this.events.down)==null?void 0:l.event)??this.events.up.event]),this.hovered=!0;else if(!s&&this.hovered){if(this.eventListeners.hoverEnd.length>0){const u=[this.events.down,this.events.up,this.events.move].find(w=>w!==void 0&&!this.pointIsInPath(t,w.translatedPoint.x,w.translatedPoint.y));g(this.eventListeners,"hoverEnd",[this,u.translatedPoint,u.event])}this.hovered=!1}this.name!==""&&((d=this.events)!=null&&d.keydown&&this.eventListeners.keydown.length>0&&this.events.stage.keyTarget===this.name&&g(this.eventListeners,"keydown",[this,this.events.keydown]),(f=this.events)!=null&&f.keyup&&this.eventListeners.keyup.length>0&&this.events.stage.keyTarget===this.name&&g(this.eventListeners,"keyup",[this,this.events.keyup]),this.events.scroll&&this.eventListeners.scroll.length>0&&s&&this.events.stage.scrollTarget===this.name&&g(this.eventListeners,"scroll",[this,this.events.scroll]));const h=(u,w,v,C,R,p)=>{const{event:W,translatedPoint:Y}=w,X=u.getTransform().inverse().transformPoint(Y),E=u.getTransform(),F=function(A){u.save(),u.setTransform(E.a,E.b,E.c,E.d,E.e,E.f),g(C.eventListeners,R,[C,X,W]),A!==void 0&&(C.pointerId=A),u.restore()};R===void 0?v.rootPointerEventCallback=(function(A){A!==void 0&&(C.pointerId=A)}).bind(this,p):v.rootPointerEventCallback=F.bind(this,p)};if(this.events.move&&!this.events.up&&!this.events.down&&this.pointerId!==void 0&&this.eventListeners.drag.length>0&&(t.restore(),e=!0,h(t,this.events.move,this.root,this,"drag",this.pointerId)),this.events.up){if(t.restore(),e=!0,this.eventListeners.release.length>0&&this.pointerId!==void 0){const u=this.events.up;h(t,u,this.root,this,"release")}this.pointerId=void 0}else if(this.events.down&&s){t.restore(),e=!0;const u=this.events.down;this.eventListeners.click.length>0?h(t,u,this.root,this,"click",u.event.pointerId):h(t,u,this.root,this,void 0,u.event.pointerId)}return e}pointIsInPath(t,e,s){return t.isPointInPath(this._region,e,s)}static initializeProps(t){return{color:t.color??n(0,0,0),alpha:t.alpha??1,rotation:t.rotation??0,scale:t.scale??c(1,1),bounds:t.bounds??S(0,0,0,0),name:t.name??"",effects:t.effects??(()=>{})}}logHierarchy(t=0){const e=this.name===""?this.constructor.name:this.name,s=[this.red,this.green,this.blue].every(o=>o<25)?125:this.red,h=[this.red,this.green,this.blue].every(o=>o<25)?125:this.green,r=[this.red,this.green,this.blue].every(o=>o<25)?125:this.blue;console.log(`%c${"	".repeat(t)} âŒž${e} 	{ ${this.constructor.name} @ (${this.x1}, ${this.y1}) (${this.x2}, ${this.y2}) }`,`color: ${B(n(s,h,r))}; font-weight: bold;`),this._children.forEach(o=>o.logHierarchy(t+1))}distribute(t,e={loop:!1,iterations:1,delay:0}){if(t.length>this.channels.length)throw new Error(`Cannot distribute ${t.length} animations to ${this.channels.length} channels`);for(let s=0;s<t.length;s++){const h=t[s];this.channels[s%this.channels.length].push(h,e)}return this}set(t,e){return this[t]=e,!0}animate(){const t=this.channels.map(e=>e.stepForward()).filter(e=>e!==null);for(const e of t.reverse())this.animateProperty(e);return this}animateProperty(t){if((t._from===void 0||t.frame===0)&&(t.from===null?t._from=this[t.property]:t._from=t.from),t._to===void 0||t.frame===0)if(typeof t.to=="function"){const i=t.to;t._to=i(t._from)}else t._to=t.to;const[e,s,h,r,o]=[t._from,t._to,t.frame??0,t.duration,t.easing];if(typeof this[t.property]=="number"&&typeof e=="number"&&typeof s=="number")this.set(t.property,e+o(h/r)*(s-e));else if(typeof this[t.property]=="object"){(typeof e!="object"||typeof s!="object")&&this.raiseAnimationError(e,s,t.property);const i={...s};for(const l of Object.keys(s)){const d=e[l],f=s[l];(d===void 0||f===void 0)&&this.raiseAnimationError(e,s,l),i[l]=d+o(h/r)*(f-d)}this.set(t.property,i)}else throw new Error(`Property ${t.property} is not a valid property`);t.frame===t.duration&&g(this.eventListeners,"animationFinish",[this,t])}raiseAnimationError(t,e,s){throw new Error(`${t} -> ${e} is not a valid animation for property ${s}`)}setPointerEvents(t){return this.events=t,this}r_setPointerEvents(t){return this.setPointerEvents(t),this._children.forEach(e=>e.r_setPointerEvents(t)),this}createChannels(t){return this.channels.push(...Array.from({length:t},()=>new I)),this}schedule(t,e){const s=(h,r,o)=>{if(r>=t)return e(h,r,o),1};return this.addEventListener("beforeDraw",s),s}selfSchedule(t,e){const s=(h,r,o)=>{if(h.currentFrame>=t)return e(h,r,o),1};return this.addEventListener("beforeDraw",s),s}scheduleExactly(t,e){const s=(h,r,o)=>{if(r===t)return e(h,r,o),1};return this.addEventListener("beforeDraw",s),s}selfScheduleExactly(t,e){const s=(h,r,o)=>{if(h.currentFrame===t)return e(h,r,o),1};return this.addEventListener("beforeDraw",s),s}delay(t,e){var r;const s=(r=this.root.stage)==null?void 0:r.currentFrame;if(s===void 0)throw new Error("Sprite must be attached to a stage to use delay");const h=(o,i,l)=>{if(i>=s+t)return e(o,i,l),1};return this.addEventListener("beforeDraw",h),h}selfDelay(t,e){const s=this.currentFrame,h=(r,o,i)=>{if(r.currentFrame>=s+t)return e(r,o,i),1};return this.addEventListener("beforeDraw",h),h}when(t,e){const s=(h,r,o)=>{if(t(h))return e(h,r,o)};return this.addEventListener("beforeDraw",s),s}whenStage(t,e){const s=(h,r,o)=>{if(t(o))return e(h,r,o)};return this.addEventListener("beforeDraw",s),s}hasEventListeners(){return Object.values(this.eventListeners).some(t=>t.length>0)}spriteOrChildrenHaveEventListeners(){return this.hasEventListeners()?!0:this._children.some(t=>t.spriteOrChildrenHaveEventListeners())}copy(){const t=structuredClone({...this,_children:void 0,_parent:void 0,_region:void 0,events:void 0,rootPointerEventCallback:void 0,drawFunction:void 0,effects:void 0,channels:void 0,eventListeners:void 0}),e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(t));e.eventListeners={};for(const[s,h]of Object.entries(this.eventListeners))e.eventListeners[s]=h.map(r=>r.bind(e));return e.channels=this.channels.map(function(){return new I}),e._children=this._children.map(s=>s.copy()),e._parent=void 0,e.rootPointerEventCallback=()=>{},e.drawFunction=this.drawFunction,e.effects=this.effects.bind(e),e}}class bt extends q{constructor(t){var e,s,h,r;t.bounds=S(((e=t.position)==null?void 0:e.x)??0,((s=t.position)==null?void 0:s.y)??0,((h=t.position)==null?void 0:h.x)??0,((r=t.position)==null?void 0:r.y)??0),t.color={red:0,green:0,blue:0,alpha:0},t.position??(t.position=c(0,0)),super(t)}get position(){return c(this.positionX,this.positionY)}set position(t){this.positionX=t.x,this.positionY=t.y}get positionX(){return this.centerX}set positionX(t){this.x1=t,this.x2=t}get positionY(){return this.centerY}set positionY(t){this.y1=t,this.y2=t}pointIsInPath(){return!1}}class x extends q{constructor(t){var e,s,h,r,o,i,l,d,f,u,w,v,C,R,p;super(t),this.strokeRed=0,this.strokeGreen=0,this.strokeBlue=0,this.strokeAlpha=1,this.strokeWidth=1,this.strokeJoin="miter",this.strokeCap="butt",this.strokeDash=0,this.strokeDashGap=0,this.strokeOffset=0,this.strokeEnabled=!1,this.strokeRed=((s=(e=t.stroke)==null?void 0:e.color)==null?void 0:s.red)??0,this.strokeGreen=((r=(h=t.stroke)==null?void 0:h.color)==null?void 0:r.green)??0,this.strokeBlue=((i=(o=t.stroke)==null?void 0:o.color)==null?void 0:i.blue)??0,this.strokeAlpha=((d=(l=t.stroke)==null?void 0:l.color)==null?void 0:d.alpha)??1,this.strokeWidth=((f=t.stroke)==null?void 0:f.lineWidth)??1,this.strokeJoin=((u=t.stroke)==null?void 0:u.lineJoin)??"miter",this.strokeCap=((w=t.stroke)==null?void 0:w.lineCap)??"butt",this.strokeDash=((v=t.stroke)==null?void 0:v.lineDash)??0,this.strokeDashGap=((C=t.stroke)==null?void 0:C.lineDashGap)??((R=t.stroke)==null?void 0:R.lineDash)??0,this.strokeOffset=((p=t.stroke)==null?void 0:p.lineDashOffset)??0,this.strokeEnabled=t.stroke!==null&&t.stroke!==void 0}get stroke(){return this.strokeEnabled?{color:{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha},lineWidth:this.strokeWidth,lineJoin:this.strokeJoin,lineCap:this.strokeCap,lineDash:this.strokeDash,lineDashGap:this.strokeDashGap,lineDashOffset:this.strokeOffset}:null}set stroke(t){var e,s,h,r;this.strokeEnabled=t!==null,t!==null&&(this.strokeRed=((e=t.color)==null?void 0:e.red)??0,this.strokeGreen=((s=t.color)==null?void 0:s.green)??0,this.strokeBlue=((h=t.color)==null?void 0:h.blue)??0,this.strokeAlpha=((r=t.color)==null?void 0:r.alpha)??1,this.strokeWidth=t.lineWidth??1,this.strokeJoin=t.lineJoin??"miter",this.strokeCap=t.lineCap??"butt",this.strokeDash=t.lineDash??0,this.strokeDashGap=t.lineDashGap??t.lineDash??0,this.strokeOffset=t.lineDashOffset??0)}get strokeColor(){return{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha}}set strokeColor(t){this.strokeRed=t.red,this.strokeGreen=t.green,this.strokeBlue=t.blue,this.strokeAlpha=t.alpha}static strokeRegion(t,e,s){var h,r,o,i;e!=null&&e.lineWidth!==0&&(t.lineWidth=e.lineWidth??1,t.lineJoin=e.lineJoin??"miter",t.lineCap=e.lineCap??"round",t.strokeStyle=`rgba(${((h=e.color)==null?void 0:h.red)??0}, ${((r=e.color)==null?void 0:r.green)??0}, ${((o=e.color)==null?void 0:o.blue)??0}, ${((i=e.color)==null?void 0:i.alpha)??1})`,t.setLineDash([e.lineDash??0,e.lineDashGap??0]),t.lineDashOffset=e.lineDashOffset??0,s&&t.stroke(s))}draw(t,e){super.draw(t,{...e,stroke:this.strokeEnabled?{color:{red:this.strokeRed,green:this.strokeGreen,blue:this.strokeBlue,alpha:this.strokeAlpha},lineWidth:this.strokeWidth,lineJoin:this.strokeJoin,lineCap:this.strokeCap,lineDash:this.strokeDash,lineDashGap:this.strokeDashGap,lineDashOffset:this.strokeOffset}:null})}}class L extends q{constructor(t){super(t),this.lineWidth=1,this.lineCap="butt",this.lineDash=0,this.lineDashGap=0,this.lineDashOffset=0,this.arrowLength=20,this.arrowSide="end",this.arrowAngle=90,this.arrowStrokeRed=0,this.arrowStrokeGreen=0,this.arrowStrokeBlue=0,this.arrowStrokeAlpha=1,this.arrowStrokeWidth=1,this.arrowStrokeJoin="miter",this.arrowStrokeCap="butt",this.arrowStrokeDash=0,this.arrowStrokeDashGap=0,this.arrowStrokeDashOffset=0,this.arrowStrokeEnabled=!0,this.arrowClosed=!1,this.arrowRed=0,this.arrowGreen=0,this.arrowBlue=0,this.arrowAlpha=1,this.drawFunction=(e,s)=>{var o;const h=N(s.bounds??S(0,0,0,0));e.lineWidth=s.lineWidth??1,e.lineCap=s.lineCap??"butt",e.strokeStyle=B(s.color??n(0,0,0)),e.setLineDash([s.lineDash??0,s.lineDashGap??0]),e.lineDashOffset=s.lineDashOffset??0,e.beginPath(),e.moveTo(h.x1,h.y1),e.lineTo(h.x2,h.y2),e.stroke(),e.closePath();const r=new Path2D;return r.moveTo(h.x1,h.y1),r.lineTo(h.x2,h.y2),r.addPath(L.drawArrow(e,h,s.arrow??{},((o=s.arrow)==null?void 0:o.stroke)??{})),r},this.lineWidth=t.lineWidth??1,this.lineCap=t.lineCap??"butt",this.lineDash=t.lineDash??0,this.lineDashGap=t.lineDashGap??0,this.lineDashOffset=t.lineDashOffset??0,this.arrow=t.arrow??{}}get arrowStroke(){return{color:n(this.arrowStrokeRed,this.arrowStrokeGreen,this.arrowStrokeBlue,this.arrowStrokeAlpha),lineWidth:this.arrowStrokeWidth,lineJoin:this.arrowStrokeJoin,lineCap:this.arrowStrokeCap,lineDash:this.arrowStrokeDash,lineDashGap:this.arrowStrokeDashGap,lineDashOffset:this.arrowStrokeDashOffset}}set arrowStroke(t){var e,s,h,r;this.arrowStrokeRed=((e=t.color)==null?void 0:e.red)??0,this.arrowStrokeGreen=((s=t.color)==null?void 0:s.green)??0,this.arrowStrokeBlue=((h=t.color)==null?void 0:h.blue)??0,this.arrowStrokeAlpha=((r=t.color)==null?void 0:r.alpha)??1,this.arrowStrokeWidth=t.lineWidth??1,this.arrowStrokeJoin=t.lineJoin??"miter",this.arrowStrokeCap=t.lineCap??"butt",this.arrowStrokeDash=t.lineDash??0,this.arrowStrokeDashGap=t.lineDashGap??0,this.arrowStrokeDashOffset=t.lineDashOffset??0}get arrowStrokeColor(){return n(this.arrowStrokeRed,this.arrowStrokeGreen,this.arrowStrokeBlue,this.arrowStrokeAlpha)}set arrowStrokeColor(t){this.arrowStrokeRed=t.red,this.arrowStrokeGreen=t.green,this.arrowStrokeBlue=t.blue,this.arrowStrokeAlpha=t.alpha}get arrowColor(){return n(this.arrowRed,this.arrowGreen,this.arrowBlue,this.arrowAlpha)}set arrowColor(t){this.arrowRed=t.red,this.arrowGreen=t.green,this.arrowBlue=t.blue,this.arrowAlpha=t.alpha}get arrow(){return{length:this.arrowLength,side:this.arrowSide,angle:this.arrowAngle,stroke:this.arrowStroke,closed:this.arrowClosed,color:this.arrowColor}}set arrow(t){this.arrowLength=t.length??20,this.arrowSide=t.side??(t.length!==void 0||t.angle!==void 0||t.color!==void 0||t.stroke!==void 0||t.closed!==void 0)?"end":"none",this.arrowAngle=t.angle??90,this.arrowStroke=t.stroke??{},this.arrowClosed=t.closed??!1,this.arrowColor=t.color??n(0,0,0,0)}draw(t,e){super.draw(t,{...e,bounds:this.bounds,lineWidth:this.lineWidth,lineCap:this.lineCap,lineDash:this.lineDash,lineDashGap:this.lineDashGap,lineDashOffset:this.lineDashOffset,color:n(this.red,this.green,this.blue,this.colorAlpha),arrow:this.arrow})}static getArrowCoordinates(t,e,s,h){s=s*Math.PI/360;const[r,o]=[h*Math.sin(s),h*Math.cos(s)];e/=2;const i={x:(e-o)*Math.cos(t)-r*Math.sin(t),y:r*Math.cos(t)+(e-o)*Math.sin(t)},l={x:e*Math.cos(t),y:e*Math.sin(t)},d={x:(e-o)*Math.cos(t)+r*Math.sin(t),y:-r*Math.cos(t)+(e-o)*Math.sin(t)};return[i,l,d]}static drawArrow(t,e,s,h=void 0,r={x:0,y:0}){if(s.side==="none"||s.length===0)return new Path2D;const o=Math.atan2(e.y2-e.y1,e.x2-e.x1),i=new Path2D;if(t.fillStyle=B(s.color??n(0,0,0,0)),s.side==="start"||s.side==="both"){const l=L.getArrowCoordinates(o+Math.PI,Math.sqrt((e.x2-e.x1)**2+(e.y2-e.y1)**2),s.angle??0,s.length??0),d=new Path2D;d.moveTo(l[0].x+r.x,l[0].y+r.y),d.lineTo(l[1].x+r.x,l[1].y+r.y),d.lineTo(l[2].x+r.x,l[2].y+r.y),s.closed&&d.closePath(),t.fillStyle=B(s.color??n(0,0,0,0)),t.fill(d,s.closed?"evenodd":"nonzero"),x.strokeRegion(t,h,d),i.addPath(d)}if(s.side==="end"||s.side==="both"){const l=L.getArrowCoordinates(o,Math.sqrt((e.x2-e.x1)**2+(e.y2-e.y1)**2),s.angle??0,s.length??0),d=new Path2D;d.moveTo(l[0].x+r.x,l[0].y+r.y),d.lineTo(l[1].x+r.x,l[1].y+r.y),d.lineTo(l[2].x+r.x,l[2].y+r.y),s.closed&&d.closePath(),t.fillStyle=B(s.color??n(0,0,0,0)),t.fill(d,s.closed?"evenodd":"nonzero"),x.strokeRegion(t,h,d),i.addPath(d)}return i}static Bounds(t,e,s,h){return S(t,e,s,h)}}class P extends x{constructor(t){super(t),this.radius=[0],this.drawFunction=P.drawFunction,this.radius=t.radius??[0]}draw(t){super.draw(t,{bounds:this.bounds,radius:this.radius})}static Bounds(t,e,s,h){return xt(t,e,s,h)}}P.drawFunction=(a,t)=>{var s,h;const e=N(t.bounds??S(0,0,0,0));if(t.stroke===null||((s=t.stroke)==null?void 0:s.lineWidth)===0)if(t.radius&&t.radius[0]===0&&t.radius.length===1){const r=new Path2D;return r.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),a.fill(r,"nonzero"),r}else{const r=new Path2D;return r.roundRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t.radius),a.fill(r,"nonzero"),r}if(x.strokeRegion(a,t.stroke),((h=t.stroke)==null?void 0:h.lineDash)===0){const r=new Path2D;return r.roundRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t.radius),a.fill(r,"nonzero"),a.stroke(r),r}else{const r=new Path2D;return r.roundRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t.radius),a.fill(r,"nonzero"),a.stroke(r),r}};class Dt extends x{constructor(t){var h,r;super(t),this.startAngle=0,this.endAngle=360,this.drawFunction=(o,i)=>{const[l,d]=typeof i.radius=="number"?[i.radius,i.radius]:i.radius??[5,5],f=J(i.center.x,i.center.y,l,d),u=mt(f);o.beginPath();const w=new Path2D;return w.ellipse(0,0,u[2]/2,u[3]/2,0,(i.startAngle??0)*Math.PI/180,(i.endAngle??0)*Math.PI/180),w.closePath(),o.fill(w,"nonzero"),o.closePath(),x.strokeRegion(o,i.stroke,w),w},this.startAngle=t.startAngle??0,this.endAngle=t.endAngle??360;const e=typeof t.radius=="number"?[t.radius,t.radius]:t.radius??[5,5];this.radiusX=e[0],this.radiusY=e[1];const s=J(((h=t.center)==null?void 0:h.x)??0,((r=t.center)==null?void 0:r.y)??0,e[0],e[1]);this.x1=s.x1,this.y1=s.y1,this.x2=s.x2,this.y2=s.y2}get radius(){return[this.radiusX,this.radiusY]}set radius(t){typeof t=="number"?(this.radiusX=t,this.radiusY=t):(this.radiusX=t[0],this.radiusY=t[1])}get radiusX(){return this.width/2}set radiusX(t){this.width=t*2}get radiusY(){return this.height/2}set radiusY(t){this.height=t*2}draw(t){super.draw(t,{center:{x:this.centerX,y:this.centerY},radius:[this.radiusX,this.radiusY],startAngle:this.startAngle,endAngle:this.endAngle})}}class O extends x{constructor(t){var e,s,h,r;t.bounds=O.getBoundsFromCurves(c(((e=t.start)==null?void 0:e.x)??0,((s=t.start)==null?void 0:s.y)??0),t.points??[]),super(t),this.startX=0,this.startY=0,this.points=[],this.closePath=!1,this.fillRule="nonzero",this.arrowLength=20,this.arrowSide="end",this.arrowAngle=90,this.arrowStrokeRed=0,this.arrowStrokeGreen=0,this.arrowStrokeBlue=0,this.arrowStrokeAlpha=1,this.arrowStrokeWidth=1,this.arrowStrokeJoin="miter",this.arrowStrokeCap="butt",this.arrowStrokeDash=0,this.arrowStrokeDashGap=0,this.arrowStrokeDashOffset=0,this.arrowStrokeEnabled=!0,this.arrowClosed=!1,this.arrowRed=0,this.arrowGreen=0,this.arrowBlue=0,this.arrowAlpha=1,this.drawFunction=(o,i)=>{var R,p,W,Y,X,E,F,A,Z,tt,et,st,it,nt,rt,ht,ot,at,lt,dt,ct,ut,ft,wt,gt,yt,kt,vt;let[l,d,f,u]=[((R=i.start)==null?void 0:R.x)??0,((p=i.start)==null?void 0:p.y)??0,((W=i.start)==null?void 0:W.x)??0,((Y=i.start)==null?void 0:Y.y)??0];(X=i.points)==null||X.forEach(y=>{l=Math.min(l,y.end.x),d=Math.min(d,y.end.y),f=Math.max(f,y.end.x),u=Math.max(u,y.end.y)});const w=S(l,d,f,u),v=new Path2D;v.moveTo(k(w,c(((E=i.start)==null?void 0:E.x)??0,((F=i.start)==null?void 0:F.y)??0)).x,k(w,c(((A=i.start)==null?void 0:A.x)??0,((Z=i.start)==null?void 0:Z.y)??0)).y),(tt=i.points)==null||tt.forEach(y=>{v.bezierCurveTo(k(w,c(y.control1.x,y.control1.y)).x,k(w,c(y.control1.x,y.control1.y)).y,k(w,c(y.control2.x,y.control2.y)).x,k(w,c(y.control2.x,y.control2.y)).y,k(w,c(y.end.x,y.end.y)).x,k(w,c(y.end.x,y.end.y)).y)}),i.closePath&&v.closePath(),o.fill(v,i.fillRule??"nonzero"),x.strokeRegion(o,i.stroke,v);const C=((et=i.arrow)==null?void 0:et.side)??"none";if(((st=i==null?void 0:i.arrow)==null?void 0:st.side)==="start"||((it=i==null?void 0:i.arrow)==null?void 0:it.side)==="both"){const y=k(w,{x:((nt=i.start)==null?void 0:nt.x)??0,y:((rt=i.start)==null?void 0:rt.y)??0}),G=k(w,(ht=i.points)!=null&&ht.length?{x:i.points[0].control1.x,y:i.points[0].control1.y}:{x:((ot=i.start)==null?void 0:ot.x)??0,y:((at=i.start)==null?void 0:at.y)??0}),D={x1:y.x,y1:y.y,x2:G.x,y2:G.y},z={x:(D.x1+D.x2)/2,y:(D.y1+D.y2)/2};i.arrow.side="start",v.addPath(L.drawArrow(o,D,i.arrow,(lt=i.arrow)==null?void 0:lt.stroke,z))}if(i.arrow.side=C,((dt=i==null?void 0:i.arrow)==null?void 0:dt.side)==="end"||((ct=i==null?void 0:i.arrow)==null?void 0:ct.side)==="both"){const y=k(w,(ut=i.points)!=null&&ut.length?{x:i.points[i.points.length-1].end.x,y:i.points[i.points.length-1].end.y}:{x:((ft=i.start)==null?void 0:ft.x)??0,y:((wt=i.start)==null?void 0:wt.y)??0}),G=k(w,(gt=i.points)!=null&&gt.length?{x:i.points[i.points.length-1].control2.x,y:i.points[i.points.length-1].control2.y}:{x:((yt=i.start)==null?void 0:yt.x)??0,y:((kt=i.start)==null?void 0:kt.y)??0}),D={x1:G.x,y1:G.y,x2:y.x,y2:y.y},z={x:(D.x1+D.x2)/2,y:(D.y1+D.y2)/2};i.arrow.side="end",v.addPath(L.drawArrow(o,D,i.arrow,(vt=i.arrow)==null?void 0:vt.stroke,z))}return i.arrow.side=C,v},this.points=t.points??[],this.closePath=t.closePath??!1,this.fillRule=t.fillRule??"nonzero",this.startX=((h=t.start)==null?void 0:h.x)??0,this.startY=((r=t.start)==null?void 0:r.y)??0,this.arrow=t.arrow??{}}get start(){return c(this.startX,this.startY)}set start(t){this.startX=t.x,this.startY=t.y}get arrowStroke(){return{color:n(this.arrowStrokeRed,this.arrowStrokeGreen,this.arrowStrokeBlue,this.arrowStrokeAlpha),lineWidth:this.arrowStrokeWidth,lineJoin:this.arrowStrokeJoin,lineCap:this.arrowStrokeCap,lineDash:this.arrowStrokeDash,lineDashGap:this.arrowStrokeDashGap,lineDashOffset:this.arrowStrokeDashOffset}}set arrowStroke(t){var e,s,h,r;this.arrowStrokeRed=((e=t.color)==null?void 0:e.red)??0,this.arrowStrokeGreen=((s=t.color)==null?void 0:s.green)??0,this.arrowStrokeBlue=((h=t.color)==null?void 0:h.blue)??0,this.arrowStrokeAlpha=((r=t.color)==null?void 0:r.alpha)??1,this.arrowStrokeWidth=t.lineWidth??1,this.arrowStrokeJoin=t.lineJoin??"miter",this.arrowStrokeCap=t.lineCap??"butt",this.arrowStrokeDash=t.lineDash??0,this.arrowStrokeDashGap=t.lineDashGap??0,this.arrowStrokeDashOffset=t.lineDashOffset??0}get arrowStrokeColor(){return n(this.arrowStrokeRed,this.arrowStrokeGreen,this.arrowStrokeBlue,this.arrowStrokeAlpha)}set arrowStrokeColor(t){this.arrowStrokeRed=t.red,this.arrowStrokeGreen=t.green,this.arrowStrokeBlue=t.blue,this.arrowStrokeAlpha=t.alpha}get arrowColor(){return n(this.arrowRed,this.arrowGreen,this.arrowBlue,this.arrowAlpha)}set arrowColor(t){this.arrowRed=t.red,this.arrowGreen=t.green,this.arrowBlue=t.blue,this.arrowAlpha=t.alpha}get arrow(){return{length:this.arrowLength,side:this.arrowSide,angle:this.arrowAngle,stroke:this.arrowStroke,closed:this.arrowClosed,color:this.arrowColor}}set arrow(t){this.arrowLength=t.length??20,this.arrowSide=t.side??(t.length!==void 0||t.angle!==void 0||t.color!==void 0||t.stroke!==void 0||t.closed!==void 0)?"end":"none",this.arrowAngle=t.angle??90,this.arrowStroke=t.stroke??{},this.arrowClosed=t.closed??!1,this.arrowColor=t.color??n(0,0,0,0)}set bounds(t){throw new Error("Bounds cannot be set on BezierCurve")}draw(t){const e=O.getBoundsFromCurves(c(this.startX,this.startY),this.points);this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,super.draw(t,{start:c(this.startX,this.startY),points:this.points,closePath:this.closePath,fillRule:this.fillRule,arrow:this.arrow})}static getBoundsFromCurves(t,e){let[s,h,r,o]=[t.x,t.y,t.x,t.y];return e.forEach(i=>{s=Math.min(s,i.end.x),h=Math.min(h,i.end.y),r=Math.max(r,i.end.x),o=Math.max(o,i.end.y)}),S(s,h,r,o)}}class m extends x{constructor(t){super(t),this.path=[],this.closePath=!1,this.fillRule="nonzero",this.startRatio=0,this.endRatio=1,this.drawFunction=m.drawFunction,this.path=t.path??[],this.closePath=t.closePath??!1,this.fillRule=t.fillRule??"nonzero",this.startRatio=t.startRatio??0,this.endRatio=t.endRatio??1;const e=m.getBoundsFromPath(this.path);this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}get bounds(){return m.getBoundsFromPath(this.path)}set bounds(t){throw new Error("Bounds cannot be set on Path")}draw(t){const e=m.getBoundsFromPath(this.path);this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,super.draw(t,{path:this.path,closePath:this.closePath,fillRule:this.fillRule,startRatio:this.startRatio,endRatio:this.endRatio})}static getPathSegment(t,e,s){if(e===0&&s===1)return t;if(e===s)return[];if(e>s)return m.getPathSegment(t,s,e).reverse();if(e<0||s>1)throw new Error("Start and end must be between 0 and 1");const h=t.map((d,f)=>m.calculateDistance(d,t[f+1]??t[0]));h.pop();const r=h.reduce((d,f)=>d+f,0),o=[];let i=0,l=0;for(const d of h){const f=d/r;if(l+f<e){l+=f,i++;continue}let u=0;l+f>e&&l<e&&(u=(e-l)*(1/f));let w=1;if(l+f>s&&l<s&&(w=(s-l)*(1/f)),l+f>e&&o.push(m.interpolate(t[i],t[i+1]??t[0],u)),l<s&&l+f>s)return o.push(m.interpolate(t[i],t[i+1]??t[0],w)),o;l+=f,i++}return s===1?o.concat(t[t.length-1]):o}static interpolate(t,e,s){return c(t.x+s*(e.x-t.x),t.y+s*(e.y-t.y))}static calculateDistance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static getBoundsFromPath(t){return S(Math.min(...t.map(e=>e.x)),Math.min(...t.map(e=>e.y)),Math.max(...t.map(e=>e.x)),Math.max(...t.map(e=>e.y)))}}m.drawFunction=(a,t)=>{var h;let e=((h=t.path)==null?void 0:h.map(r=>k(m.getBoundsFromPath(t.path??[]),r)))??[];if(e=m.getPathSegment(e,t.startRatio??0,t.endRatio??1),e.length===0)return new Path2D;const s=new Path2D;s.moveTo(e[0].x,e[0].y);for(const r of e.slice(1))s.lineTo(r.x,r.y);return t.closePath&&s.closePath(),a.fill(s,t.fillRule??"nonzero"),x.strokeRegion(a,t.stroke,s),s};class Pt extends x{constructor(t){super(t),this.radius=5,this.innerRadius=(this.radius??5)*(3-Math.sqrt(5))/2,this.fillRule="nonzero",this.startRatio=0,this.endRatio=1,this._centerX=0,this._centerY=0,this.drawFunction=(s,h)=>{const r=h.radius??5,o=h.innerRadius??r*(3-Math.sqrt(5))/2,i=(d,f)=>c(f*Math.cos(Math.PI/2+d),f*Math.sin(Math.PI/2+d)),l=[i(0,r),i(2*Math.PI/10,o),i(2*Math.PI/5,r),i(6*Math.PI/10,o),i(4*Math.PI/5,r),i(10*Math.PI/10,o),i(6*Math.PI/5,r),i(14*Math.PI/10,o),i(8*Math.PI/5,r),i(18*Math.PI/10,o)];return m.drawFunction(s,{path:l,fillRule:h.fillRule??"nonzero",closePath:!0,stroke:h.stroke,startRatio:h.startRatio??0,endRatio:h.endRatio??1})},this.radius=t.radius??5,this.fillRule=t.fillRule??"nonzero",this.startRatio=t.startRatio??0,this.endRatio=t.endRatio??1,this.innerRadius=t.innerRadius??(t.radius??5)*(3-Math.sqrt(5))/2;const e=t.center??{x:0,y:0};this.centerX=e.x,this.centerY=e.y}get centerX(){return this._centerX}set centerX(t){this._centerX=t,this.x1=this._centerX-this.radius,this.x2=this._centerX+this.radius}get centerY(){return this._centerY}set centerY(t){this._centerY=t,this.y1=this._centerY-this.radius,this.y2=this._centerY+this.radius}get center(){return{x:this.centerX,y:this.centerY}}set center(t){this._centerX=t.x,this._centerY=t.y}set bounds(t){throw new Error("Polygon bounds cannot be set")}draw(t){this.x1=this.centerX-this.radius,this.y1=this.centerY-this.radius,this.x2=this.centerX+this.radius,this.y2=this.centerY+this.radius,super.draw(t,{center:c(this.centerX,this.centerY),radius:this.radius,innerRadius:this.innerRadius,startRatio:this.startRatio,endRatio:this.endRatio,fillRule:this.fillRule})}}class H extends x{constructor(t){var e,s;super(t),this.text="",this.positionIsCenter=!1,this.font="sans-serif",this.fontSize=16,this.bold=!1,this.italic=!1,this.textAlign="start",this.textBaseline="alphabetic",this.textDirection="inherit",this.maxWidth=null,this.positionX=0,this.positionY=0,this.drawFunction=H.drawFunction,this.text=t.text??"",this.positionX=((e=t.position)==null?void 0:e.x)??0,this.positionY=((s=t.position)==null?void 0:s.y)??0,this.positionIsCenter=t.positionIsCenter??!1,this.font=t.font??"sans-serif",this.fontSize=t.fontSize??16,this.textAlign=t.textAlign??"start",this.textBaseline=t.textBaseline??"alphabetic",this.textDirection=t.textDirection??"inherit",this.maxWidth=t.maxWidth??null,this.bold=t.bold??!1,this.italic=t.italic??!1}get position(){return c(this.positionX,this.positionY)}set position(t){this.positionX=t.x,this.positionY=t.y}draw(t){var o,i;((o=this.root.stage)==null?void 0:o.rootStyle)==="centered"&&(this.scaleY*=-1),t.font=`${this.bold?"bold ":""}${this.italic?"italic ":""}${this.fontSize}px ${this.font}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.direction=this.textDirection;const e=t.measureText(this.text),s=e.width,h=e.actualBoundingBoxAscent,r=this.fontSize;this.positionIsCenter?(this.x1=this.positionX-s/2,this.y1=this.positionY-r/2+(this.fontSize-h),this.x2=this.positionX+s/2,this.y2=this.positionY+r/2):(this.x1=this.positionX,this.y1=this.positionY,this.x2=this.positionX+s,this.y2=this.positionY+r),super.draw(t,{text:this.text,position:c(this.positionX,this.positionY),font:this.font,fontSize:this.fontSize,textAlign:this.textAlign,textBaseline:this.textBaseline,textDirection:this.textDirection,maxWidth:this.maxWidth,bold:this.bold,italic:this.italic,positionIsCenter:this.positionIsCenter}),((i=this.root.stage)==null?void 0:i.rootStyle)==="centered"&&(this.scaleY*=-1)}}H.drawFunction=(a,t)=>{var l;const{text:e,maxWidth:s}=t,h=a.measureText(e??""),r=h.width,o=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent;a.fillText(e??"",-r/2,o/2,s??void 0),t.stroke!==null&&((l=t.stroke)==null?void 0:l.lineWidth)!==0&&(x.strokeRegion(a,t.stroke),a.strokeText(e??"",-r/2,o/2,s??void 0));const i=new Path2D;return i.moveTo(-r/2,-o/2),i.lineTo(r/2,-o/2),i.lineTo(r/2,o/2),i.lineTo(-r/2,o/2),i.closePath(),i};class j extends bt{constructor(t,e){super(e),this.stage=t}}class Ct{constructor(t,e="centered",s=b.White,h,r=!1){if(this.canvas=t,this.rootStyle=e,this.bgColor=s,this.active=!1,this.nextRenderTime=void 0,this.frameRate=60,this.lastRenderMs=0,this.currentFrame=0,this.drawEvents={},this.keyTarget="",this.scrollTarget="",this.resetKeyTargetOnClick=!0,this.resetScrollTargetOnClick=!0,this.onError=(o,i)=>{i=i==null?void 0:i.slice(0,i==null?void 0:i.indexOf("FrameRequestCallback*")),console.error(`WorkerStage: ${(o==null?void 0:o.message)??"Error"}
${i??""}`)},this.eventListeners={beforeDraw:[],click:[],release:[],move:[],keydown:[],keyup:[],scroll:[]},!t)throw new Error("No canvas element provided");this._root=e==="classic"?new j(this,{}):new j(this,{position:c(this.width/2,this.height/2),scale:c(1,-1)}),t.oncontextmenu=()=>!1,t.style.touchAction="none",this.ctx=h??(r?void 0:t.getContext("2d"))}get root(){return this._root}addEventListener(t,e){return this.eventListeners[t].push(e),this}on(t,e){return this.addEventListener(t,e),this}removeEventListener(t,e){return e?(this.eventListeners[t]=this.eventListeners[t].filter(s=>s!==e),this):(this.eventListeners[t]=[],this)}includeEventListener(t,e){return this.removeEventListener(t,e),this.addEventListener(t,e),this}pointerDownHandler(t){var s;if(!this.active)return;t.preventDefault();const e=c((t.offsetX||t.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((t.offsetY||t.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));g(this.eventListeners,"click",[this,e,t]),this.drawEvents.down={event:t,translatedPoint:this.positionOnCanvas(this.canvas,t)},(s=this.canvas)!=null&&s.focus&&this.canvas.focus()}pointerUpHandler(t){if(!this.active)return;t.preventDefault();const e=c((t.offsetX||t.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((t.offsetY||t.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));g(this.eventListeners,"release",[this,e,t]),this.drawEvents.up={event:t,translatedPoint:this.positionOnCanvas(this.canvas,t)}}pointerMoveHandler(t){if(!this.active)return;t.preventDefault();const e=c((t.offsetX||t.pageX-this.canvas.offsetLeft)*this.scaleX-(this.rootStyle==="centered"?this.width/2:0),((t.offsetY||t.pageY-this.canvas.offsetTop)*this.scaleY-(this.rootStyle==="centered"?this.height/2:0))*(this.rootStyle==="centered"?-1:1));g(this.eventListeners,"move",[this,e,t]),this.drawEvents.move={event:t,translatedPoint:this.positionOnCanvas(this.canvas,t)}}keydownHandler(t){this.active&&(t.preventDefault(),g(this.eventListeners,"keydown",[this,t]),this.drawEvents.keydown=t)}keyupHandler(t){this.active&&(t.preventDefault(),g(this.eventListeners,"keyup",[this,t]),this.drawEvents.keyup=t)}wheelHandler(t){this.active&&(g(this.eventListeners,"scroll",[this,t]),this.drawEvents.scroll=t,t.preventDefault())}positionOnCanvas(t,e){return c((e.offsetX||e.clientX-t.getBoundingClientRect().left)*t.width/t.clientWidth,(e.offsetY||e.clientY-t.getBoundingClientRect().top)*t.height/t.clientHeight)}loop(t=60){return this.stop(),this.canvas.addEventListener("pointerdown",this.pointerDownHandler.bind(this)),this.canvas.addEventListener("pointerup",this.pointerUpHandler.bind(this)),this.canvas.addEventListener("pointermove",this.pointerMoveHandler.bind(this)),this.canvas.addEventListener("wheel",this.wheelHandler.bind(this)),this.canvas.addEventListener("keydown",this.keydownHandler.bind(this)),this.canvas.addEventListener("keyup",this.keyupHandler.bind(this)),this.active=!0,this.frameRate=t,this.nextRenderTime=performance.now(),this.currentFrame=0,requestAnimationFrame(this.drawLoop.bind(this)),this}drawLoop(){const t=performance.now();if(this.nextRenderTime&&t<this.nextRenderTime){requestAnimationFrame(this.drawLoop.bind(this));return}this.nextRenderTime=t+800/this.frameRate,this.active&&(this.draw(this.ctx),this.lastRenderMs=performance.now()-t,requestAnimationFrame(this.drawLoop.bind(this)))}draw(t){t??(t=this.ctx),g(this.eventListeners,"beforeDraw",[this,this.currentFrame,this]),this.root.setPointerEvents(this.drawEvents),t.fillStyle=B(this.bgColor),t.fillRect(0,0,this.width??0,this.height??0),this.drawEvents.stage=this;try{this.root.draw(t)}catch(e){return this.stop(),this.onError(e),!1}return this.drawEvents={stage:this},this.resetKeyTargetOnClick&&this.drawEvents.up&&this.keyTarget!==""&&this.root.findDescendants(this.keyTarget).some(e=>e.pointerId===void 0)&&(this.keyTarget=""),this.resetScrollTargetOnClick&&this.drawEvents.down&&this.scrollTarget!==""&&this.root.findDescendants(this.scrollTarget).some(e=>e.pointerId===void 0)&&(this.scrollTarget=""),this.currentFrame++,!0}stop(){return this.canvas.removeEventListener("pointerdown",this.pointerDownHandler.bind(this)),this.canvas.removeEventListener("pointerup",this.pointerUpHandler.bind(this)),this.canvas.removeEventListener("pointermove",this.pointerMoveHandler.bind(this)),this.canvas.removeEventListener("wheel",this.wheelHandler.bind(this)),this.canvas.removeEventListener("keydown",this.keydownHandler.bind(this)),this.canvas.removeEventListener("keyup",this.keyupHandler.bind(this)),this.active=!1,this}get width(){var t;return(t=this.canvas)==null?void 0:t.width}get height(){var t;return(t=this.canvas)==null?void 0:t.height}get scaleX(){return(this.width??0)/this.canvas.clientWidth}get scaleY(){return(this.height??0)/this.canvas.clientHeight}}const Et={width:0,height:0,oncontextmenu:()=>!1,style:{touchAction:"none"},getContext:()=>null,offsetLeft:0,offsetTop:0,addEventListener:()=>{},clientWidth:0,clientHeight:0,getBoundingClientRect:()=>({top:0,left:0}),removeEventListener:()=>{},transferToImageBitmap:()=>{}};class Lt extends Ct{constructor(t,e="centered",s=b.White){const h=new OffscreenCanvas(1,1);super(Et,e,s,h.getContext("2d")),this._postMessage=t,this.rootStyle=e,this.bgColor=s,this.eventListeners={beforeDraw:[],click:[],release:[],move:[],scroll:[],message:[],keyup:[],keydown:[]},this.onError=function(r){this.postMessage({type:"error",error:(r==null?void 0:r.message)??"Error",stack:(r==null?void 0:r.stack)??"No stack"})},this.informOffscreenOfStop=!0,this.onmessage=r=>{g(this.eventListeners,"message",[this,r.data],this.sendErrorString.bind(this));const o=r.data;switch(o.type){case"init":this.canvas.height=o.height,this.canvas.offsetLeft=0,this.canvas.offsetTop=0,this.offscreenCanvas.width=o.width,this.offscreenCanvas.height=o.height,this._root.position=this.rootStyle==="centered"?c(o.width/2,o.height/2):c(0,0),this.postMessage({type:"ready"}),this.loop();break;case"beginLoop":this.setStageState({...o.stageState,type:"stageState"}),this.loop(o.frameRate*1.25);break;case"stageState":this.setStageState(o);break;case"stopLoop":this.stop();break}},this.offscreenCanvas=h}addEventListener(t,e){return this.eventListeners[t].push(e),this}on(t,e){return this.addEventListener(t,e),this}removeEventListener(t,e){return e?(this.eventListeners[t]=this.eventListeners[t].filter(s=>s!==e),this):(this.eventListeners[t]=[],this)}includeEventListener(t,e){return this.removeEventListener(t,e),this.addEventListener(t,e),this}setStageState(t){var e,s,h,r,o,i;this.nextDrawEvents??(this.nextDrawEvents={}),(e=this.nextDrawEvents).up??(e.up=t.events.up),(s=this.nextDrawEvents).down??(s.down=t.events.down),(h=this.nextDrawEvents).move??(h.move=t.events.move),(r=this.nextDrawEvents).keydown??(r.keydown=t.events.keydown),(o=this.nextDrawEvents).keyup??(o.keyup=t.events.keyup),(i=this.nextDrawEvents).scroll??(i.scroll=t.events.scroll),this.canvas.width=t.canvasProperties.width,this.canvas.height=t.canvasProperties.height,this.canvas.offsetLeft=t.canvasProperties.offsetLeft,this.canvas.offsetTop=t.canvasProperties.offsetTop,this.canvas.clientWidth=t.canvasProperties.clientWidth,this.canvas.clientHeight=t.canvasProperties.clientHeight,this.canvas.getBoundingClientRect=()=>t.canvasProperties.boundingClientRect}sendErrorString(t){const e=new Error(t);this.onError(e)}draw(t){this.drawEvents=this.nextDrawEvents?JSON.parse(JSON.stringify(this.nextDrawEvents)):this.drawEvents,g(this.eventListeners,"beforeDraw",[this,this.currentFrame,this],this.sendErrorString.bind(this));const{down:e,up:s,move:h,keydown:r,keyup:o,scroll:i}=this.drawEvents;e&&g(this.eventListeners,"click",[this,{x:e.translatedPoint.x-(this.rootStyle==="centered"?this.canvas.width/2:0),y:(e.translatedPoint.y-(this.rootStyle==="centered"?this.canvas.height/2:0))*(this.rootStyle==="centered"?-1:1)},e.event],this.sendErrorString.bind(this)),s&&g(this.eventListeners,"release",[this,{x:s.translatedPoint.x-(this.rootStyle==="centered"?this.canvas.width/2:0),y:(s.translatedPoint.y-(this.rootStyle==="centered"?this.canvas.height/2:0))*(this.rootStyle==="centered"?-1:1)},s.event],this.sendErrorString.bind(this)),h&&g(this.eventListeners,"move",[this,{x:h.translatedPoint.x-(this.rootStyle==="centered"?this.canvas.width/2:0),y:(h.translatedPoint.y-(this.rootStyle==="centered"?this.canvas.height/2:0))*(this.rootStyle==="centered"?-1:1)},h.event],this.sendErrorString.bind(this)),r&&g(this.eventListeners,"keydown",[this,r],this.sendErrorString.bind(this)),o&&g(this.eventListeners,"keyup",[this,o],this.sendErrorString.bind(this)),i&&g(this.eventListeners,"scroll",[this,i],this.sendErrorString.bind(this)),this.resetKeyTargetOnClick&&this.drawEvents.up&&this.keyTarget!==""&&this.root.findDescendants(this.keyTarget).some(l=>l.pointerId===void 0)&&(this.keyTarget=""),this.resetScrollTargetOnClick&&this.drawEvents.down&&this.scrollTarget!==""&&this.root.findDescendants(this.scrollTarget).some(l=>l.pointerId===void 0)&&(this.scrollTarget="");try{super.draw(t)}catch(l){return this.onError(l),!1}return this.postMessage({type:"render",img:this.offscreenCanvas.transferToImageBitmap(),lastRenderMs:this.lastRenderMs,currentFrame:this.currentFrame}),this.nextDrawEvents=void 0,!0}postCustomMessage(t,e){this.postMessage({type:"custom",message:t},e)}postMessage(t,e){if(!e){this._postMessage(t);return}e.postMessage(t)}loop(t=60){return this.informOffscreenOfStop=!1,super.loop(t),this.informOffscreenOfStop=!0,this}stop(){return super.stop(),this.informOffscreenOfStop&&this.postMessage({type:"stopLoop",source:"worker"}),this}}const $=new Lt(postMessage.bind(null),"classic",b.LightSlateGray);onmessage=$.onmessage;const V=new L({bounds:L.Bounds(50,50,175,150),color:b.Aqua,lineWidth:5,lineCap:"round"}),M={color:b.Transparent,stroke:{color:b.White,lineWidth:5,lineDash:5}},Rt=new P({bounds:V.bounds,...M}),K=new P({bounds:P.Bounds(250,50,150,100),color:b.Aqua}),pt=new P({bounds:K.bounds,...M}),U=new Dt({center:{x:525,y:225},radius:67.5,color:b.Aqua}),At=new P({bounds:U.bounds,...M}),Q=new Pt({center:{x:112.5,y:275},radius:67.5,color:b.Aqua}),_=new O({start:{x:250,y:212.5},points:[{control1:{x:300,y:250},control2:{x:267.5,y:325},end:{x:375,y:380}},{control1:{x:350,y:280},control2:{x:225,y:290},end:{x:400,y:300}}],color:b.Transparent,stroke:{color:b.Aqua,lineWidth:5}}),Bt=new P({bounds:S(_.x1,_.y1,_.x2,_.y2),...M}),Mt=new P({bounds:Q.bounds,...M});$.root.addChildren(V,Rt,K,pt,U,At,Q,Mt,_,Bt),$.draw()})();
